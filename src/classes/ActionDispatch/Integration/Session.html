---
title: ActionDispatch::Integration::Session
layout: default
---
<div class="main">
    <div class="banner">
        
            <span>Ruby on Rails 8.1.0</span><br />
        
        <div class="type">Class</div>
        <h1>
            ActionDispatch::Integration::Session
            
                <span class="parent">&lt;
                    
                    <a href="../../Object.html">Object</a>
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../../../files/actionpack/lib/action_dispatch/testing/integration_rb.html">actionpack/lib/action_dispatch/testing/integration.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
  
    <div class="description">
      
<p>An instance of this class represents a set of requests and responses performed sequentially by a test process. Because you can instantiate multiple sessions and run them side-by-side, you can also mimic (to some limited extent) multiple simultaneous users interacting with your system.</p>

<p>Typically, you will instantiate a new session using <a href="Runner.html#method-i-open_session"><code>Runner#open_session</code></a>, rather than instantiating a <a href="Session.html"><code>Session</code></a> directly.</p>

    </div>
  

  

  
  


  

  
    <h2 id="methods">Methods</h2>
    <ul>
      
        <li>
          <a href="#method-i-cookies">cookies</a>
        </li>
      
        <li>
          <a href="#method-i-host">host</a>
        </li>
      
        <li>
          <a href="#method-i-https-21">https!</a>
        </li>
      
        <li>
          <a href="#method-i-https-3F">https?</a>
        </li>
      
        <li>
          <a href="#method-c-new">new</a>
        </li>
      
        <li>
          <a href="#method-i-process">process</a>
        </li>
      
        <li>
          <a href="#method-i-reset-21">reset!</a>
        </li>
      
        <li>
          <a href="#method-i-url_options">url_options</a>
        </li>
      
    </ul>
  

  
    <!-- Includes -->
    <h2 id="included-modules">Included Modules</h2>
    <ul>
      
        <li>
          
            Minitest::Assertions
          
        </li>
      
        <li>
          
            <a href="../Routing/UrlFor.html">
              ActionDispatch::Routing::UrlFor
            </a>
          
        </li>
      
    </ul>
  

  
    

    

    
      <!-- Section constants -->
      <h2 id="constants">Constants</h2>
      <table border='0' cellpadding='5'>
        
          <tr valign='top'>
            <td class="attr-name">DEFAULT_HOST</td>
            <td>=</td>
            <td class="attr-value">&quot;www.example.com&quot;</td>
          </tr>
          
        
      </table>
    

    
      <!-- Section attributes -->
      <h2 id="attributes">Attributes</h2>
      <table border='0' cellpadding='5'>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [RW]
            </td>
            <td class='attr-name'>accept</td>
            <td class='attr-desc'><p>The Accept header to send.</p></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [R]
            </td>
            <td class='attr-name'>controller</td>
            <td class='attr-desc'><p>A reference to the controller instance used by the last request.</p></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [W]
            </td>
            <td class='attr-name'>host</td>
            <td class='attr-desc'></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [W]
            </td>
            <td class='attr-name'>host!</td>
            <td class='attr-desc'></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [RW]
            </td>
            <td class='attr-name'>remote_addr</td>
            <td class='attr-desc'><p>The <a href="Session.html#attribute-i-remote_addr"><code>remote_addr</code></a> used in the last request.</p></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [R]
            </td>
            <td class='attr-name'>request</td>
            <td class='attr-desc'><p>A reference to the request instance used by the last request.</p></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [RW]
            </td>
            <td class='attr-name'>request_count</td>
            <td class='attr-desc'><p>A running counter of the number of requests processed.</p></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [R]
            </td>
            <td class='attr-name'>response</td>
            <td class='attr-desc'><p>A reference to the response instance used by the last request.</p></td>
          </tr>
        
      </table>
    

    <!-- Methods -->
    
      <h2 id="class-public-methods">Class Public methods</h2>
      
        <div class="method">
          <h3 id="method-c-new"><code><b>new</b>(app)</code></h3>

          <div class="description">
<p>Create and initialize a new <a href="Session.html"><code>Session</code></a> instance.</p>
</div>

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">üìù Source code</span>
              </summary>

              <pre><code class="ruby"># File actionpack/lib/action_dispatch/testing/integration.rb, line 133
def initialize(app)
  super()
  @app = app

  reset!
end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/actionpack/lib/action_dispatch/testing/integration.rb#L133" target="_blank" class="github_url">üîé See on GitHub</a>
              
            </details>
          
        </div>
        
      
    
      <h2 id="instance-public-methods">Instance Public methods</h2>
      
        <div class="method">
          <h3 id="method-i-cookies"><code><b>cookies</b>()</code></h3>

          <div class="description">
<p>A map of the cookies returned by the last response, and which will be sent with the next request.</p>
</div>

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">üìù Source code</span>
              </summary>

              <pre><code class="ruby"># File actionpack/lib/action_dispatch/testing/integration.rb, line 114
def cookies
  _mock_session.cookie_jar
end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/actionpack/lib/action_dispatch/testing/integration.rb#L114" target="_blank" class="github_url">üîé See on GitHub</a>
              
            </details>
          
        </div>
        
        <div class="method">
          <h3 id="method-i-host"><code><b>host</b>()</code></h3>

          <div class="description">
<p>The hostname used in the last request.</p>
</div>

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">üìù Source code</span>
              </summary>

              <pre><code class="ruby"># File actionpack/lib/action_dispatch/testing/integration.rb, line 101
def host
  @host || DEFAULT_HOST
end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/actionpack/lib/action_dispatch/testing/integration.rb#L101" target="_blank" class="github_url">üîé See on GitHub</a>
              
            </details>
          
        </div>
        
        <div class="method">
          <h3 id="method-i-https-21"><code><b>https!</b>(flag = true)</code></h3>

          <div class="description">
<p>Specify whether or not the session should mimic a secure HTTPS request.</p>

<pre><code>session.https!
session.https!(false)
</code></pre>
</div>

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">üìù Source code</span>
              </summary>

              <pre><code class="ruby"># File actionpack/lib/action_dispatch/testing/integration.rb, line 180
def https!(flag = true)
  @https = flag
end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/actionpack/lib/action_dispatch/testing/integration.rb#L180" target="_blank" class="github_url">üîé See on GitHub</a>
              
            </details>
          
        </div>
        
        <div class="method">
          <h3 id="method-i-https-3F"><code><b>https?</b>()</code></h3>

          <div class="description">
<p>Returns <code>true</code> if the session is mimicking a secure HTTPS request.</p>

<pre><code>if session.https?
  ...
end
</code></pre>
</div>

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">üìù Source code</span>
              </summary>

              <pre><code class="ruby"># File actionpack/lib/action_dispatch/testing/integration.rb, line 189
def https?
  @https
end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/actionpack/lib/action_dispatch/testing/integration.rb#L189" target="_blank" class="github_url">üîé See on GitHub</a>
              
            </details>
          
        </div>
        
        <div class="method">
          <h3 id="method-i-process"><code><b>process</b>(method, path, params: nil, headers: nil, env: nil, xhr: false, as: nil)</code></h3>

          <div class="description">
<p>Performs the actual request.</p>
<ul><li>
<p><code>method</code>: The HTTP method (GET, POST, PATCH, PUT, DELETE, HEAD, OPTIONS) as a symbol.</p>
</li><li>
<p><code>path</code>: The URI (as a <a href="../../String.html"><code>String</code></a>) on which you want to perform the request.</p>
</li><li>
<p><code>params</code>: The HTTP parameters that you want to pass. This may be <code>nil</code>, a <a href="../../Hash.html"><code>Hash</code></a>, or a <a href="../../String.html"><code>String</code></a> that is appropriately encoded (<code>application/x-www-form-urlencoded</code> or <code>multipart/form-data</code>).</p>
</li><li>
<p><code>headers</code>: Additional headers to pass, as a <a href="../../Hash.html"><code>Hash</code></a>. The headers will be merged into the Rack env hash.</p>
</li><li>
<p><code>env</code>: Additional env to pass, as a <a href="../../Hash.html"><code>Hash</code></a>. The headers will be merged into the Rack env hash.</p>
</li><li>
<p><code>xhr</code>: Set to <code>true</code> if you want to make an Ajax request. Adds request headers characteristic of XMLHttpRequest e.g. HTTP_X_REQUESTED_WITH. The headers will be merged into the Rack env hash.</p>
</li><li>
<p><code>as</code>: Used for encoding the request with different content type. Supports <code>:json</code> by default and will set the appropriate request headers. The headers will be merged into the Rack env hash.</p>
</li></ul>

<p>This method is rarely used directly. Use <a href="RequestHelpers.html#method-i-get"><code>RequestHelpers#get</code></a>, <a href="RequestHelpers.html#method-i-post"><code>RequestHelpers#post</code></a>, or other standard HTTP methods in integration tests. <a href="Session.html#method-i-process"><code>process</code></a> is only required when using a request method that doesn‚Äôt have a method defined in the integration tests.</p>

<p>This method returns the response status, after performing the request. Furthermore, if this method was called from an <a href="../IntegrationTest.html"><code>ActionDispatch::IntegrationTest</code></a> object, then that object‚Äôs <code>@response</code> instance variable will point to a <a href="../Response.html"><code>Response</code></a> object which one can use to inspect the details of the response.</p>

<p>Example: process :get, ‚Äò/author‚Äô, params: { since: 201501011400 }</p>
</div>

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">üìù Source code</span>
              </summary>

              <pre><code class="ruby"># File actionpack/lib/action_dispatch/testing/integration.rb, line 225
def process(method, path, params: nil, headers: nil, env: nil, xhr: false, as: nil)
  request_encoder = RequestEncoder.encoder(as)
  headers ||= {}

  if method == :get &amp;&amp; as == :json &amp;&amp; params
    headers[&quot;X-Http-Method-Override&quot;] = &quot;GET&quot;
    method = :post
  end

  if path.include?(&quot;://&quot;)
    path = build_expanded_path(path) do |location|
      https! URI::HTTPS === location if location.scheme

      if url_host = location.host
        default = Rack::Request::DEFAULT_PORTS[location.scheme]
        url_host += &quot;:#{location.port}&quot; if default != location.port
        host! url_host
      end
    end
  end

  hostname, port = host.split(&quot;:&quot;)

  request_env = {
    :method =&gt; method,
    :params =&gt; request_encoder.encode_params(params),

    &quot;SERVER_NAME&quot;     =&gt; hostname,
    &quot;SERVER_PORT&quot;     =&gt; port || (https? ? &quot;443&quot; : &quot;80&quot;),
    &quot;HTTPS&quot;           =&gt; https? ? &quot;on&quot; : &quot;off&quot;,
    &quot;rack.url_scheme&quot; =&gt; https? ? &quot;https&quot; : &quot;http&quot;,

    &quot;REQUEST_URI&quot;    =&gt; path,
    &quot;HTTP_HOST&quot;      =&gt; host,
    &quot;REMOTE_ADDR&quot;    =&gt; remote_addr,
    &quot;HTTP_ACCEPT&quot;    =&gt; request_encoder.accept_header || accept
  }

  if request_encoder.content_type
    request_env[&quot;CONTENT_TYPE&quot;] = request_encoder.content_type
  end

  wrapped_headers = Http::Headers.from_hash({})
  wrapped_headers.merge!(headers) if headers

  if xhr
    wrapped_headers[&quot;HTTP_X_REQUESTED_WITH&quot;] = &quot;XMLHttpRequest&quot;
    wrapped_headers[&quot;HTTP_ACCEPT&quot;] ||= [Mime[:js], Mime[:html], Mime[:xml], &quot;text/xml&quot;, &quot;*/*&quot;].join(&quot;, &quot;)
  end

  # This modifies the passed request_env directly.
  if wrapped_headers.present?
    Http::Headers.from_hash(request_env).merge!(wrapped_headers)
  end
  if env.present?
    Http::Headers.from_hash(request_env).merge!(env)
  end

  session = Rack::Test::Session.new(_mock_session)

  # NOTE: rack-test v0.5 doesn&#39;t build a default uri correctly Make sure requested
  # path is always a full URI.
  uri = build_full_uri(path, request_env)

  if method == :get &amp;&amp; String === request_env[:params]
    # rack-test will needlessly parse and rebuild a :params
    # querystring, using Rack&#39;s query parser. At best that&#39;s a
    # waste of time; at worst it can change the value.

    uri &lt;&lt; &quot;?&quot; &lt;&lt; request_env.delete(:params)
  end

  session.request(uri, request_env)

  @request_count += 1
  @request = ActionDispatch::Request.new(session.last_request.env)
  response = _mock_session.last_response
  @response = ActionDispatch::TestResponse.from_response(response)
  @response.request = @request
  @html_document = nil
  @url_options = nil

  @controller = @request.controller_instance

  response.status
end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/actionpack/lib/action_dispatch/testing/integration.rb#L225" target="_blank" class="github_url">üîé See on GitHub</a>
              
            </details>
          
        </div>
        
        <div class="method">
          <h3 id="method-i-reset-21"><code><b>reset!</b>()</code></h3>

          <div class="description">
<p>Resets the instance. This can be used to reset the state information in an existing session instance, so it can be used from a clean-slate condition.</p>

<pre><code>session.reset!
</code></pre>
</div>

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">üìù Source code</span>
              </summary>

              <pre><code class="ruby"># File actionpack/lib/action_dispatch/testing/integration.rb, line 156
def reset!
  @https = false
  @controller = @request = @response = nil
  @_mock_session = nil
  @request_count = 0
  @url_options = nil

  self.host        = DEFAULT_HOST
  self.remote_addr = &quot;127.0.0.1&quot;
  self.accept      = &quot;text/xml,application/xml,application/xhtml+xml,&quot; \
                     &quot;text/html;q=0.9,text/plain;q=0.8,image/png,&quot; \
                     &quot;*/*;q=0.5&quot;

  unless defined? @named_routes_configured
    # the helpers are made protected by default--we make them public for easier
    # access during testing and troubleshooting.
    @named_routes_configured = true
  end
end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/actionpack/lib/action_dispatch/testing/integration.rb#L156" target="_blank" class="github_url">üîé See on GitHub</a>
              
            </details>
          
        </div>
        
        <div class="method">
          <h3 id="method-i-url_options"><code><b>url_options</b>()</code></h3>

          

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">üìù Source code</span>
              </summary>

              <pre><code class="ruby"># File actionpack/lib/action_dispatch/testing/integration.rb, line 140
def url_options
  @url_options ||= default_url_options.dup.tap do |url_options|
    url_options.reverse_merge!(controller.url_options) if controller.respond_to?(:url_options)

    if @app.respond_to?(:routes)
      url_options.reverse_merge!(@app.routes.default_url_options)
    end

    url_options.reverse_merge!(host: host, protocol: https? ? &quot;https&quot; : &quot;http&quot;)
  end
end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/actionpack/lib/action_dispatch/testing/integration.rb#L140" target="_blank" class="github_url">üîé See on GitHub</a>
              
            </details>
          
        </div>
        
      
    
  
</div>

    </div>
</div>
