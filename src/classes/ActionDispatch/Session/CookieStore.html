---
title: ActionDispatch::Session::CookieStore
layout: default
---
<div class="main">
    <div class="banner">
        
            <span>Ruby on Rails 7.0.4</span><br />
        
        <div class="type">Class</div>
        <h1>
            ActionDispatch::Session::CookieStore
            
                <span class="parent">&lt;
                    
                    <a href="AbstractSecureStore.html">ActionDispatch::Session::AbstractSecureStore</a>
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../../../files/actionpack/lib/action_dispatch/middleware/session/cookie_store_rb.html">actionpack/lib/action_dispatch/middleware/session/cookie_store.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
  
    <div class="description">
      
<p>This cookie-based session store is the Rails default. It is dramatically faster than the alternatives.</p>

<p>Sessions typically contain at most a user ID and flash message; both fit within the 4096 bytes cookie size limit. A <code>CookieOverflow</code> exception is raised if you attempt to store more than 4096 bytes of data.</p>

<p>The cookie jar used for storage is automatically configured to be the best possible option given your application&#39;s configuration.</p>

<p>Your cookies will be encrypted using your application&#39;s <code>secret_key_base</code>. This goes a step further than signed cookies in that encrypted cookies cannot be altered or read by users. This is the default starting in Rails 4.</p>

<p>Configure your session store in an initializer:</p>

<pre><code>Rails.application.config.session_store :cookie_store, key: &#39;_your_app_session&#39;
</code></pre>

<p>In the development and test environments your application&#39;s <code>secret_key_base</code> is generated by Rails and stored in a temporary file in <code>tmp/development_secret.txt</code>. In all other environments, it is stored encrypted in the <code>config/credentials.yml.enc</code> file.</p>

<p>If your application was not updated to Rails 5.2 defaults, the <code>secret_key_base</code> will be found in the old <code>config/secrets.yml</code> file.</p>

<p>Note that changing your <code>secret_key_base</code> will invalidate all existing session. Additionally, you should take care to make sure you are not relying on the ability to decode signed cookies generated by your app in external applications or JavaScript before changing it.</p>

<p>Because <a href="CookieStore.html"><code>CookieStore</code></a> extends <code>Rack::Session::Abstract::Persisted</code>, many of the options described there can be used to customize the session cookie that is generated. For example:</p>

<pre><code>Rails.application.config.session_store :cookie_store, expire_after: 14.days
</code></pre>

<p>would set the session cookie to expire automatically 14 days after creation. Other useful options include <code>:key</code>, <code>:secure</code>, <code>:httponly</code>, and <code>:same_site</code>.</p>

    </div>
  

  

  
  


  
    <h2 id="namespace">Namespace</h2>

    

    
      <h3 id="class">Class</h3>
      <ul>
      
        <li><a href="CookieStore/SessionId.html">ActionDispatch::Session::CookieStore::SessionId</a></li>
      
      </ul>
    
  

  
    <h2 id="methods">Methods</h2>
    <ul>
      
        <li>
          <a href="#method-i-delete_session">delete_session</a>
        </li>
      
        <li>
          <a href="#method-i-load_session">load_session</a>
        </li>
      
        <li>
          <a href="#method-c-new">new</a>
        </li>
      
    </ul>
  

  

  
    

    

    

    

    <!-- Methods -->
    
      <h2 id="class-public-methods">Class Public methods</h2>
      
        <div class="method">
          <h3 id="method-c-new">
            
              new(app, options = {})
            
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-c-new_source">
                <pre><code class="ruby"><span class="ruby-comment"># File actionpack/lib/action_dispatch/middleware/session/cookie_store.rb, line 59</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">initialize</span>(<span class="ruby-identifier">app</span>, <span class="ruby-identifier">options</span> = {})
  <span class="ruby-keyword">super</span>(<span class="ruby-identifier">app</span>, <span class="ruby-identifier">options</span>.<span class="ruby-identifier">merge!</span>(<span class="ruby-value">cookie_only:</span> <span class="ruby-keyword">true</span>))
<span class="ruby-keyword">end</span></code></pre>
              </div>
            </div>
            
          </div>
        
      
    
      <h2 id="instance-public-methods">Instance Public methods</h2>
      
        <div class="method">
          <h3 id="method-i-delete_session">
            
              delete_session(req, session_id, options)
            
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-delete_session_source">
                <pre><code class="ruby"><span class="ruby-comment"># File actionpack/lib/action_dispatch/middleware/session/cookie_store.rb, line 63</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">delete_session</span>(<span class="ruby-identifier">req</span>, <span class="ruby-identifier">session_id</span>, <span class="ruby-identifier">options</span>)
  <span class="ruby-identifier">new_sid</span> = <span class="ruby-identifier">generate_sid</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:drop</span>]
  <span class="ruby-comment"># Reset hash and Assign the new session id</span>
  <span class="ruby-identifier">req</span>.<span class="ruby-identifier">set_header</span>(<span class="ruby-string">&quot;action_dispatch.request.unsigned_session_cookie&quot;</span>, <span class="ruby-identifier">new_sid</span> <span class="ruby-operator">?</span> { <span class="ruby-string">&quot;session_id&quot;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">new_sid</span>.<span class="ruby-identifier">public_id</span> } <span class="ruby-operator">:</span> {})
  <span class="ruby-identifier">new_sid</span>
<span class="ruby-keyword">end</span></code></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-load_session">
            
              load_session(req)
            
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-load_session_source">
                <pre><code class="ruby"><span class="ruby-comment"># File actionpack/lib/action_dispatch/middleware/session/cookie_store.rb, line 70</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">load_session</span>(<span class="ruby-identifier">req</span>)
  <span class="ruby-identifier">stale_session_check!</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">data</span> = <span class="ruby-identifier">unpacked_cookie_data</span>(<span class="ruby-identifier">req</span>)
    <span class="ruby-identifier">data</span> = <span class="ruby-identifier">persistent_session_id!</span>(<span class="ruby-identifier">data</span>)
    [<span class="ruby-constant">Rack</span><span class="ruby-operator">::</span><span class="ruby-constant">Session</span><span class="ruby-operator">::</span><span class="ruby-constant">SessionId</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">data</span>[<span class="ruby-string">&quot;session_id&quot;</span>]), <span class="ruby-identifier">data</span>]
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></code></pre>
              </div>
            </div>
            
          </div>
        
      
    
  
</div>

    </div>
</div>
