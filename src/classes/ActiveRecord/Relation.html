---
title: ActiveRecord::Relation
layout: default
---
<div class="main">
    <div class="banner">
        
            <span>Ruby on Rails 5.2.5</span><br />
        
        <div class="type">Class</div>
        <h1>
            ActiveRecord::Relation
            
                <span class="parent">&lt;
                    
                    <a href="../Object.html">Object</a>
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../../files/activerecord/lib/active_record/relation_rb.html">activerecord/lib/active_record/relation.rb</a></li>
            
            <li><a href="../../files/activerecord/lib/active_record/relation/batches_rb.html">activerecord/lib/active_record/relation/batches.rb</a></li>
            
            <li><a href="../../files/activerecord/lib/active_record/relation/from_clause_rb.html">activerecord/lib/active_record/relation/from_clause.rb</a></li>
            
            <li><a href="../../files/activerecord/lib/active_record/relation/merger_rb.html">activerecord/lib/active_record/relation/merger.rb</a></li>
            
            <li><a href="../../files/activerecord/lib/active_record/relation/predicate_builder_rb.html">activerecord/lib/active_record/relation/predicate_builder.rb</a></li>
            
            <li><a href="../../files/activerecord/lib/active_record/relation/query_attribute_rb.html">activerecord/lib/active_record/relation/query_attribute.rb</a></li>
            
            <li><a href="../../files/activerecord/lib/active_record/relation/query_methods_rb.html">activerecord/lib/active_record/relation/query_methods.rb</a></li>
            
            <li><a href="../../files/activerecord/lib/active_record/relation/record_fetch_warning_rb.html">activerecord/lib/active_record/relation/record_fetch_warning.rb</a></li>
            
            <li><a href="../../files/activerecord/lib/active_record/relation/spawn_methods_rb.html">activerecord/lib/active_record/relation/spawn_methods.rb</a></li>
            
            <li><a href="../../files/activerecord/lib/active_record/relation/where_clause_rb.html">activerecord/lib/active_record/relation/where_clause.rb</a></li>
            
            <li><a href="../../files/activerecord/lib/active_record/relation/where_clause_factory_rb.html">activerecord/lib/active_record/relation/where_clause_factory.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
  
    <div class="description">
      
<h1 id="class-ActiveRecord::Relation-label-Active+Record+Relation">Active Record Relation</h1>

    </div>
  

  

  
  


  
    <h2 id="namespace">Namespace</h2>

    
      <h3 id="module">Module</h3>
      <ul>
      
        <li><a href="Relation/RecordFetchWarning.html">ActiveRecord::Relation::RecordFetchWarning</a></li>
      
      </ul>
    

    
  

  
    <h2 id="methods">Methods</h2>
    <ul>
      
        <li>
          <a href="#method-i-3D-3D">==</a>
        </li>
      
        <li>
          <a href="#method-i-any-3F">any?</a>
        </li>
      
        <li>
          <a href="#method-i-blank-3F">blank?</a>
        </li>
      
        <li>
          <a href="#method-i-build">build</a>
        </li>
      
        <li>
          <a href="#method-i-cache_key">cache_key</a>
        </li>
      
        <li>
          <a href="#method-i-create">create</a>
        </li>
      
        <li>
          <a href="#method-i-create-21">create!</a>
        </li>
      
        <li>
          <a href="#method-i-delete_all">delete_all</a>
        </li>
      
        <li>
          <a href="#method-i-destroy_all">destroy_all</a>
        </li>
      
        <li>
          <a href="#method-i-eager_loading-3F">eager_loading?</a>
        </li>
      
        <li>
          <a href="#method-i-empty-3F">empty?</a>
        </li>
      
        <li>
          <a href="#method-i-encode_with">encode_with</a>
        </li>
      
        <li>
          <a href="#method-i-explain">explain</a>
        </li>
      
        <li>
          <a href="#method-i-find_or_create_by">find_or_create_by</a>
        </li>
      
        <li>
          <a href="#method-i-find_or_create_by-21">find_or_create_by!</a>
        </li>
      
        <li>
          <a href="#method-i-find_or_initialize_by">find_or_initialize_by</a>
        </li>
      
        <li>
          <a href="#method-i-initialize_copy">initialize_copy</a>
        </li>
      
        <li>
          <a href="#method-i-inspect">inspect</a>
        </li>
      
        <li>
          <a href="#method-i-joined_includes_values">joined_includes_values</a>
        </li>
      
        <li>
          <a href="#method-i-load">load</a>
        </li>
      
        <li>
          <a href="#method-i-load_records">load_records</a>
        </li>
      
        <li>
          <a href="#method-i-many-3F">many?</a>
        </li>
      
        <li>
          <a href="#method-i-new">new</a>
        </li>
      
        <li>
          <a href="#method-c-new">new</a>
        </li>
      
        <li>
          <a href="#method-i-none-3F">none?</a>
        </li>
      
        <li>
          <a href="#method-i-one-3F">one?</a>
        </li>
      
        <li>
          <a href="#method-i-pretty_print">pretty_print</a>
        </li>
      
        <li>
          <a href="#method-i-reload">reload</a>
        </li>
      
        <li>
          <a href="#method-i-reset">reset</a>
        </li>
      
        <li>
          <a href="#method-i-scope_for_create">scope_for_create</a>
        </li>
      
        <li>
          <a href="#method-i-scoping">scoping</a>
        </li>
      
        <li>
          <a href="#method-i-size">size</a>
        </li>
      
        <li>
          <a href="#method-i-to_a">to_a</a>
        </li>
      
        <li>
          <a href="#method-i-to_ary">to_ary</a>
        </li>
      
        <li>
          <a href="#method-i-to_sql">to_sql</a>
        </li>
      
        <li>
          <a href="#method-i-update_all">update_all</a>
        </li>
      
        <li>
          <a href="#method-i-values">values</a>
        </li>
      
        <li>
          <a href="#method-i-where_values_hash">where_values_hash</a>
        </li>
      
    </ul>
  

  
    <!-- Includes -->
    <h2 id="included-modules">Included Modules</h2>
    <ul>
      
        <li>
          
            <a href="../Enumerable.html">
              Enumerable
            </a>
          
        </li>
      
    </ul>
  

  
    

    

    
      <!-- Section constants -->
      <h2 id="constants">Constants</h2>
      <table border='0' cellpadding='5'>
        
          <tr valign='top'>
            <td class="attr-name">CLAUSE_METHODS</td>
            <td>=</td>
            <td class="attr-value">[:where, :having, :from]</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">INVALID_METHODS_FOR_DELETE_ALL</td>
            <td>=</td>
            <td class="attr-value">[:distinct, :group, :having]</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">MULTI_VALUE_METHODS</td>
            <td>=</td>
            <td class="attr-value">[:includes, :eager_load, :preload, :select, :group,
:order, :joins, :left_outer_joins, :references,
:extending, :unscope]</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">SINGLE_VALUE_METHODS</td>
            <td>=</td>
            <td class="attr-value">[:limit, :offset, :lock, :readonly, :reordering,
:reverse_order, :distinct, :create_with, :skip_query_cache]</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">VALUE_METHODS</td>
            <td>=</td>
            <td class="attr-value">MULTI_VALUE_METHODS + SINGLE_VALUE_METHODS + CLAUSE_METHODS</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"></td>
            </tr>
          
        
      </table>
    

    
      <!-- Section attributes -->
      <h2 id="attributes">Attributes</h2>
      <table border='0' cellpadding='5'>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [R]
            </td>
            <td class='attr-name'>klass</td>
            <td class='attr-desc'></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [R]
            </td>
            <td class='attr-name'>loaded</td>
            <td class='attr-desc'></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [R]
            </td>
            <td class='attr-name'>loaded?</td>
            <td class='attr-desc'></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [R]
            </td>
            <td class='attr-name'>model</td>
            <td class='attr-desc'></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [R]
            </td>
            <td class='attr-name'>predicate_builder</td>
            <td class='attr-desc'></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [R]
            </td>
            <td class='attr-name'>table</td>
            <td class='attr-desc'></td>
          </tr>
        
      </table>
    

    <!-- Methods -->
    
      <h2 id="class-public-methods">Class Public methods</h2>
      
        <div class="method">
          <h3 id="method-c-new">
            
              new(klass, table: klass.arel_table, predicate_builder: klass.predicate_builder, values: {})
            
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-c-new_source">
                <pre><code class="ruby"><span class="ruby-comment"># File activerecord/lib/active_record/relation.rb, line 25</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">initialize</span>(<span class="ruby-identifier">klass</span>, <span class="ruby-value">table:</span> <span class="ruby-identifier">klass</span>.<span class="ruby-identifier">arel_table</span>, <span class="ruby-value">predicate_builder:</span> <span class="ruby-identifier">klass</span>.<span class="ruby-identifier">predicate_builder</span>, <span class="ruby-value">values:</span> {})
  <span class="ruby-ivar">@klass</span>  = <span class="ruby-identifier">klass</span>
  <span class="ruby-ivar">@table</span>  = <span class="ruby-identifier">table</span>
  <span class="ruby-ivar">@values</span> = <span class="ruby-identifier">values</span>
  <span class="ruby-ivar">@offsets</span> = {}
  <span class="ruby-ivar">@loaded</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-ivar">@predicate_builder</span> = <span class="ruby-identifier">predicate_builder</span>
  <span class="ruby-ivar">@delegate_to_klass</span> = <span class="ruby-keyword">false</span>
<span class="ruby-keyword">end</span></code></pre>
              </div>
            </div>
            
          </div>
        
      
    
      <h2 id="instance-public-methods">Instance Public methods</h2>
      
        <div class="method">
          <h3 id="method-i-3D-3D">
            
              ==(other)
            
          </h3>

          
            <div class="description">
              <p>Compares two relations for equality.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-3D-3D_source">
                <pre><code class="ruby"><span class="ruby-comment"># File activerecord/lib/active_record/relation.rb, line 487</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">==</span>(<span class="ruby-identifier">other</span>)
  <span class="ruby-keyword">case</span> <span class="ruby-identifier">other</span>
  <span class="ruby-keyword">when</span> <span class="ruby-constant">Associations</span><span class="ruby-operator">::</span><span class="ruby-constant">CollectionProxy</span>, <span class="ruby-constant">AssociationRelation</span>
    <span class="ruby-keyword">self</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">other</span>.<span class="ruby-identifier">records</span>
  <span class="ruby-keyword">when</span> <span class="ruby-constant">Relation</span>
    <span class="ruby-identifier">other</span>.<span class="ruby-identifier">to_sql</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">to_sql</span>
  <span class="ruby-keyword">when</span> <span class="ruby-constant">Array</span>
    <span class="ruby-identifier">records</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">other</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></code></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-any-3F">
            
              any?()
            
          </h3>

          
            <div class="description">
              <p>Returns true if there are any records.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-any-3F_source">
                <pre><code class="ruby"><span class="ruby-comment"># File activerecord/lib/active_record/relation.rb, line 227</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">any?</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">super</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">block_given?</span>
  <span class="ruby-operator">!</span><span class="ruby-identifier">empty?</span>
<span class="ruby-keyword">end</span></code></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-blank-3F">
            
              blank?()
            
          </h3>

          
            <div class="description">
              <p>Returns true if relation is blank.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-blank-3F_source">
                <pre><code class="ruby"><span class="ruby-comment"># File activerecord/lib/active_record/relation.rb, line 503</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">blank?</span>
  <span class="ruby-identifier">records</span>.<span class="ruby-identifier">blank?</span>
<span class="ruby-keyword">end</span></code></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-build">
            
              build(attributes = nil, &amp;block)
            
          </h3>

          
            <div class="description">
              
            </div>
          

          

          
            <div class="aka">
              Alias for: <a href="Relation.html#method-i-new">new</a>
            </div>
          

          
          </div>
        
        <div class="method">
          <h3 id="method-i-cache_key">
            
              cache_key(timestamp_column = :updated_at)
            
          </h3>

          
            <div class="description">
              <p>Returns a cache key that can be used to identify the records fetched by this query. The cache key is built with a fingerprint of the sql query, the number of records matched by the query and a timestamp of the last updated record. When a new record comes to match the query, or any of the existing records is updated or deleted, the cache key changes.</p>

<pre><code>Product.where(&quot;name like ?&quot;, &quot;%Cosmic Encounter%&quot;).cache_key
# =&gt; &quot;products/query-1850ab3d302391b85b8693e941286659-1-20150714212553907087000&quot;
</code></pre>

<p>If the collection is loaded, the method will iterate through the records to generate the timestamp, otherwise it will trigger one SQL query like:</p>

<pre><code>SELECT COUNT(*), MAX(&quot;products&quot;.&quot;updated_at&quot;) FROM &quot;products&quot; WHERE (name like &#39;%Cosmic Encounter%&#39;)
</code></pre>

<p>You can also pass a custom timestamp column to fetch the timestamp of the last updated record.</p>

<pre><code>Product.where(&quot;name like ?&quot;, &quot;%Game%&quot;).cache_key(:last_reviewed_at)
</code></pre>

<p>You can customize the strategy to generate the key on a per model basis overriding ActiveRecord::Base#collection_cache_key.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-cache_key_source">
                <pre><code class="ruby"><span class="ruby-comment"># File activerecord/lib/active_record/relation.rb, line 265</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">cache_key</span>(<span class="ruby-identifier">timestamp_column</span> = <span class="ruby-value">:updated_at</span>)
  <span class="ruby-ivar">@cache_keys</span> <span class="ruby-operator">||=</span> {}
  <span class="ruby-ivar">@cache_keys</span>[<span class="ruby-identifier">timestamp_column</span>] <span class="ruby-operator">||=</span> <span class="ruby-ivar">@klass</span>.<span class="ruby-identifier">collection_cache_key</span>(<span class="ruby-keyword">self</span>, <span class="ruby-identifier">timestamp_column</span>)
<span class="ruby-keyword">end</span></code></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-create">
            
              create(attributes = nil, &amp;block)
            
          </h3>

          
            <div class="description">
              <p>Tries to create a new record with the same scoped attributes defined in the relation. Returns the initialized object if validation fails.</p>

<p>Expects arguments in the same format as <a href="Persistence/ClassMethods.html#method-i-create">ActiveRecord::Base.create</a>.</p>

<h4 id="method-i-create-label-Examples">Examples</h4>

<pre><code>users = User.where(name: &#39;Oscar&#39;)
users.create # =&gt; #&lt;User id: 3, name: &quot;Oscar&quot;, ...&gt;

users.create(name: &#39;fxn&#39;)
users.create # =&gt; #&lt;User id: 4, name: &quot;fxn&quot;, ...&gt;

users.create { |user| user.name = &#39;tenderlove&#39; }
# =&gt; #&lt;User id: 5, name: &quot;tenderlove&quot;, ...&gt;

users.create(name: nil) # validation on name
# =&gt; #&lt;User id: nil, name: nil, ...&gt;
</code></pre>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-create_source">
                <pre><code class="ruby"><span class="ruby-comment"># File activerecord/lib/active_record/relation.rb, line 81</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">create</span>(<span class="ruby-identifier">attributes</span> = <span class="ruby-keyword">nil</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">attributes</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>)
    <span class="ruby-identifier">attributes</span>.<span class="ruby-identifier">collect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">attr</span><span class="ruby-operator">|</span> <span class="ruby-identifier">create</span>(<span class="ruby-identifier">attr</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>) }
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">scoping</span> { <span class="ruby-identifier">klass</span>.<span class="ruby-identifier">create</span>(<span class="ruby-identifier">values_for_create</span>(<span class="ruby-identifier">attributes</span>), <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>) }
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></code></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-create-21">
            
              create!(attributes = nil, &amp;block)
            
          </h3>

          
            <div class="description">
              <p>Similar to <a href="Relation.html#method-i-create"><code>create</code></a>, but calls <a href="Persistence/ClassMethods.html#method-i-create-21">create!</a> on the base class. Raises an exception if a validation error occurs.</p>

<p>Expects arguments in the same format as <a href="Persistence/ClassMethods.html#method-i-create-21">ActiveRecord::Base.create!</a>.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-create-21_source">
                <pre><code class="ruby"><span class="ruby-comment"># File activerecord/lib/active_record/relation.rb, line 95</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">create!</span>(<span class="ruby-identifier">attributes</span> = <span class="ruby-keyword">nil</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">attributes</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>)
    <span class="ruby-identifier">attributes</span>.<span class="ruby-identifier">collect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">attr</span><span class="ruby-operator">|</span> <span class="ruby-identifier">create!</span>(<span class="ruby-identifier">attr</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>) }
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">scoping</span> { <span class="ruby-identifier">klass</span>.<span class="ruby-identifier">create!</span>(<span class="ruby-identifier">values_for_create</span>(<span class="ruby-identifier">attributes</span>), <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>) }
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></code></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-delete_all">
            
              delete_all()
            
          </h3>

          
            <div class="description">
              <p>Deletes the records without instantiating the records first, and hence not calling the <a href="Persistence.html#method-i-destroy">#destroy</a> method nor invoking callbacks. This is a single SQL DELETE statement that goes straight to the database, much more efficient than <a href="Relation.html#method-i-destroy_all"><code>destroy_all</code></a>. Be careful with relations though, in particular <code>:dependent</code> rules defined on associations are not honored. Returns the number of rows affected.</p>

<pre><code>Post.where(person_id: 5).where(category: [&#39;Something&#39;, &#39;Else&#39;]).delete_all
</code></pre>

<p>Both calls delete the affected posts all at once with a single DELETE statement. If you need to destroy dependent associations or call your <code>before_*</code> or <code>after_destroy</code> callbacks, use the <a href="Relation.html#method-i-destroy_all"><code>destroy_all</code></a> method instead.</p>

<p>If an invalid method is supplied, <a href="Relation.html#method-i-delete_all"><code>delete_all</code></a> raises an ActiveRecordError:</p>

<pre><code>Post.distinct.delete_all
# =&gt; ActiveRecord::ActiveRecordError: delete_all doesn&#39;t support distinct
</code></pre>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-delete_all_source">
                <pre><code class="ruby"><span class="ruby-comment"># File activerecord/lib/active_record/relation.rb, line 386</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">delete_all</span>
  <span class="ruby-identifier">invalid_methods</span> = <span class="ruby-constant">INVALID_METHODS_FOR_DELETE_ALL</span>.<span class="ruby-identifier">select</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">method</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">value</span> = <span class="ruby-identifier">get_value</span>(<span class="ruby-identifier">method</span>)
    <span class="ruby-constant">SINGLE_VALUE_METHODS</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">method</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">value</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">any?</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">invalid_methods</span>.<span class="ruby-identifier">any?</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">ActiveRecordError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-node">&quot;delete_all doesn&#39;t support #{invalid_methods.join(&#39;, &#39;)}&quot;</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">eager_loading?</span>
    <span class="ruby-identifier">relation</span> = <span class="ruby-identifier">apply_join_dependency</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">relation</span>.<span class="ruby-identifier">delete_all</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">stmt</span> = <span class="ruby-constant">Arel</span><span class="ruby-operator">::</span><span class="ruby-constant">DeleteManager</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-identifier">stmt</span>.<span class="ruby-identifier">from</span>(<span class="ruby-identifier">table</span>)

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">has_join_values?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">has_limit_or_offset?</span>
    <span class="ruby-ivar">@klass</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">join_to_delete</span>(<span class="ruby-identifier">stmt</span>, <span class="ruby-identifier">arel</span>, <span class="ruby-identifier">arel_attribute</span>(<span class="ruby-identifier">primary_key</span>))
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">stmt</span>.<span class="ruby-identifier">wheres</span> = <span class="ruby-identifier">arel</span>.<span class="ruby-identifier">constraints</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">affected</span> = <span class="ruby-ivar">@klass</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">stmt</span>, <span class="ruby-node">&quot;#{@klass} Destroy&quot;</span>)

  <span class="ruby-identifier">reset</span>
  <span class="ruby-identifier">affected</span>
<span class="ruby-keyword">end</span></code></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-destroy_all">
            
              destroy_all()
            
          </h3>

          
            <div class="description">
              <p>Destroys the records by instantiating each record and calling its <a href="Persistence.html#method-i-destroy">#destroy</a> method. Each object&#39;s callbacks are executed (including <code>:dependent</code> association options). Returns the collection of objects that were destroyed; each will be frozen, to reflect that no changes should be made (since they can&#39;t be persisted).</p>

<p>Note: Instantiation, callback execution, and deletion of each record can be time consuming when you&#39;re removing many records at once. It generates at least one SQL <code>DELETE</code> query per record (or possibly more, to enforce your callbacks). If you want to delete many rows quickly, without concern for their associations or callbacks, use <a href="Relation.html#method-i-delete_all"><code>delete_all</code></a> instead.</p>

<h4 id="method-i-destroy_all-label-Examples">Examples</h4>

<pre><code>Person.where(age: 0..18).destroy_all
</code></pre>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-destroy_all_source">
                <pre><code class="ruby"><span class="ruby-comment"># File activerecord/lib/active_record/relation.rb, line 364</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">destroy_all</span>
  <span class="ruby-identifier">records</span>.<span class="ruby-identifier">each</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:destroy</span>).<span class="ruby-identifier">tap</span> { <span class="ruby-identifier">reset</span> }
<span class="ruby-keyword">end</span></code></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-eager_loading-3F">
            
              eager_loading?()
            
          </h3>

          
            <div class="description">
              <p>Returns true if relation needs eager loading.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-eager_loading-3F_source">
                <pre><code class="ruby"><span class="ruby-comment"># File activerecord/lib/active_record/relation.rb, line 472</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">eager_loading?</span>
  <span class="ruby-ivar">@should_eager_load</span> <span class="ruby-operator">||=</span>
    <span class="ruby-identifier">eager_load_values</span>.<span class="ruby-identifier">any?</span> <span class="ruby-operator">||</span>
    <span class="ruby-identifier">includes_values</span>.<span class="ruby-identifier">any?</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">joined_includes_values</span>.<span class="ruby-identifier">any?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">references_eager_loaded_tables?</span>)
<span class="ruby-keyword">end</span></code></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-empty-3F">
            
              empty?()
            
          </h3>

          
            <div class="description">
              <p>Returns true if there are no records.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-empty-3F_source">
                <pre><code class="ruby"><span class="ruby-comment"># File activerecord/lib/active_record/relation.rb, line 215</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">empty?</span>
  <span class="ruby-keyword">return</span> <span class="ruby-ivar">@records</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">loaded?</span>
  <span class="ruby-operator">!</span><span class="ruby-identifier">exists?</span>
<span class="ruby-keyword">end</span></code></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-encode_with">
            
              encode_with(coder)
            
          </h3>

          
            <div class="description">
              <p>Serializes the relation objects <a href="../Array.html"><code>Array</code></a>.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-encode_with_source">
                <pre><code class="ruby"><span class="ruby-comment"># File activerecord/lib/active_record/relation.rb, line 205</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">encode_with</span>(<span class="ruby-identifier">coder</span>)
  <span class="ruby-identifier">coder</span>.<span class="ruby-identifier">represent_seq</span>(<span class="ruby-keyword">nil</span>, <span class="ruby-identifier">records</span>)
<span class="ruby-keyword">end</span></code></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-explain">
            
              explain()
            
          </h3>

          
            <div class="description">
              <p>Runs EXPLAIN on the query or queries triggered by this relation and returns the result as a string. The string is formatted imitating the ones printed by the database shell.</p>

<p>Note that this method actually runs the queries, since the results of some are needed by the next ones when eager loading is going on.</p>

<p>Please see further details in the <a href="http://guides.rubyonrails.org/active_record_querying.html#running-explain">Active Record Query Interface guide</a>.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-explain_source">
                <pre><code class="ruby"><span class="ruby-comment"># File activerecord/lib/active_record/relation.rb, line 189</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">explain</span>
  <span class="ruby-identifier">exec_explain</span>(<span class="ruby-identifier">collecting_queries_for_explain</span> { <span class="ruby-identifier">exec_queries</span> })
<span class="ruby-keyword">end</span></code></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-find_or_create_by">
            
              find_or_create_by(attributes, &amp;block)
            
          </h3>

          
            <div class="description">
              <p>Finds the first record with the given attributes, or creates a record with the attributes if one is not found:</p>

<pre><code># Find the first user named &quot;Penélope&quot; or create a new one.
User.find_or_create_by(first_name: &#39;Penélope&#39;)
# =&gt; #&lt;User id: 1, first_name: &quot;Penélope&quot;, last_name: nil&gt;

# Find the first user named &quot;Penélope&quot; or create a new one.
# We already have one so the existing record will be returned.
User.find_or_create_by(first_name: &#39;Penélope&#39;)
# =&gt; #&lt;User id: 1, first_name: &quot;Penélope&quot;, last_name: nil&gt;

# Find the first user named &quot;Scarlett&quot; or create a new one with
# a particular last name.
User.create_with(last_name: &#39;Johansson&#39;).find_or_create_by(first_name: &#39;Scarlett&#39;)
# =&gt; #&lt;User id: 2, first_name: &quot;Scarlett&quot;, last_name: &quot;Johansson&quot;&gt;
</code></pre>

<p>This method accepts a block, which is passed down to <a href="Relation.html#method-i-create"><code>create</code></a>. The last example above can be alternatively written this way:</p>

<pre><code># Find the first user named &quot;Scarlett&quot; or create a new one with a
# different last name.
User.find_or_create_by(first_name: &#39;Scarlett&#39;) do |user|
  user.last_name = &#39;Johansson&#39;
end
# =&gt; #&lt;User id: 2, first_name: &quot;Scarlett&quot;, last_name: &quot;Johansson&quot;&gt;
</code></pre>

<p>This method always returns a record, but if creation was attempted and failed due to validation errors it won&#39;t be persisted, you get what <a href="Relation.html#method-i-create"><code>create</code></a> returns in such situation.</p>

<p>Please note *this method is not atomic*, it runs first a SELECT, and if there are no results an INSERT is attempted. If there are other threads or processes there is a race condition between both calls and it could be the case that you end up with two similar records.</p>

<p>Whether that is a problem or not depends on the logic of the application, but in the particular case in which rows have a UNIQUE constraint an exception may be raised, just retry:</p>

<pre><code>begin
  CreditAccount.transaction(requires_new: true) do
    CreditAccount.find_or_create_by(user_id: user.id)
  end
rescue ActiveRecord::RecordNotUnique
  retry
end
</code></pre>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-find_or_create_by_source">
                <pre><code class="ruby"><span class="ruby-comment"># File activerecord/lib/active_record/relation.rb, line 163</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">find_or_create_by</span>(<span class="ruby-identifier">attributes</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-identifier">find_by</span>(<span class="ruby-identifier">attributes</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">create</span>(<span class="ruby-identifier">attributes</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="ruby-keyword">end</span></code></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-find_or_create_by-21">
            
              find_or_create_by!(attributes, &amp;block)
            
          </h3>

          
            <div class="description">
              <p>Like <a href="Relation.html#method-i-find_or_create_by"><code>find_or_create_by</code></a>, but calls <a href="Persistence/ClassMethods.html#method-i-create-21">create!</a> so an exception is raised if the created record is invalid.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-find_or_create_by-21_source">
                <pre><code class="ruby"><span class="ruby-comment"># File activerecord/lib/active_record/relation.rb, line 170</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">find_or_create_by!</span>(<span class="ruby-identifier">attributes</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-identifier">find_by</span>(<span class="ruby-identifier">attributes</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">create!</span>(<span class="ruby-identifier">attributes</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="ruby-keyword">end</span></code></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-find_or_initialize_by">
            
              find_or_initialize_by(attributes, &amp;block)
            
          </h3>

          
            <div class="description">
              <p>Like <a href="Relation.html#method-i-find_or_create_by"><code>find_or_create_by</code></a>, but calls new instead of <a href="Persistence/ClassMethods.html#method-i-create">create</a>.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-find_or_initialize_by_source">
                <pre><code class="ruby"><span class="ruby-comment"># File activerecord/lib/active_record/relation.rb, line 176</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">find_or_initialize_by</span>(<span class="ruby-identifier">attributes</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-identifier">find_by</span>(<span class="ruby-identifier">attributes</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">new</span>(<span class="ruby-identifier">attributes</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="ruby-keyword">end</span></code></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-initialize_copy">
            
              initialize_copy(other)
            
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-initialize_copy_source">
                <pre><code class="ruby"><span class="ruby-comment"># File activerecord/lib/active_record/relation.rb, line 35</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">initialize_copy</span>(<span class="ruby-identifier">other</span>)
  <span class="ruby-ivar">@values</span> = <span class="ruby-ivar">@values</span>.<span class="ruby-identifier">dup</span>
  <span class="ruby-identifier">reset</span>
<span class="ruby-keyword">end</span></code></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-inspect">
            
              inspect()
            
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-inspect_source">
                <pre><code class="ruby"><span class="ruby-comment"># File activerecord/lib/active_record/relation.rb, line 511</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">inspect</span>
  <span class="ruby-identifier">subject</span> = <span class="ruby-identifier">loaded?</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">records</span> <span class="ruby-operator">:</span> <span class="ruby-keyword">self</span>
  <span class="ruby-identifier">entries</span> = <span class="ruby-identifier">subject</span>.<span class="ruby-identifier">take</span>([<span class="ruby-identifier">limit_value</span>, <span class="ruby-value">11</span>].<span class="ruby-identifier">compact</span>.<span class="ruby-identifier">min</span>).<span class="ruby-identifier">map!</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:inspect</span>)

  <span class="ruby-identifier">entries</span>[<span class="ruby-value">10</span>] = <span class="ruby-string">&quot;...&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">entries</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-value">11</span>

  <span class="ruby-node">&quot;#&lt;#{self.class.name} [#{entries.join(&#39;, &#39;)}]&gt;&quot;</span>
<span class="ruby-keyword">end</span></code></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-joined_includes_values">
            
              joined_includes_values()
            
          </h3>

          
            <div class="description">
              <p>Joins that are also marked for preloading. In which case we should just eager load them. Note that this is a naive implementation because we could have strings and symbols which represent the same association, but that aren&#39;t matched by this. Also, we could have nested hashes which partially match, e.g. { a: :b } &amp; { a: [:b, :c] }</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-joined_includes_values_source">
                <pre><code class="ruby"><span class="ruby-comment"># File activerecord/lib/active_record/relation.rb, line 482</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">joined_includes_values</span>
  <span class="ruby-identifier">includes_values</span> <span class="ruby-operator">&amp;</span> <span class="ruby-identifier">joins_values</span>
<span class="ruby-keyword">end</span></code></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-load">
            
              load(&amp;block)
            
          </h3>

          
            <div class="description">
              <p>Causes the records to be loaded from the database if they have not been loaded already. You can use this if for some reason you need to explicitly load some records before actually using them. The return value is the relation itself, not the records.</p>

<pre><code>Post.where(published: true).load # =&gt; #&lt;ActiveRecord::Relation&gt;
</code></pre>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-load_source">
                <pre><code class="ruby"><span class="ruby-comment"># File activerecord/lib/active_record/relation.rb, line 421</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">load</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-identifier">exec_queries</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">loaded?</span>

  <span class="ruby-keyword">self</span>
<span class="ruby-keyword">end</span></code></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-many-3F">
            
              many?()
            
          </h3>

          
            <div class="description">
              <p>Returns true if there is more than one record.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-many-3F_source">
                <pre><code class="ruby"><span class="ruby-comment"># File activerecord/lib/active_record/relation.rb, line 239</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">many?</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">super</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">block_given?</span>
  <span class="ruby-identifier">limit_value</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">records</span>.<span class="ruby-identifier">many?</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>
<span class="ruby-keyword">end</span></code></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-new">
            
              new(attributes = nil, &amp;block)
            
          </h3>

          
            <div class="description">
              <p>Initializes new record from relation while maintaining the current scope.</p>

<p>Expects arguments in the same format as <a href="Core.html#method-c-new">ActiveRecord::Base.new</a>.</p>

<pre><code>users = User.where(name: &#39;DHH&#39;)
user = users.new # =&gt; #&lt;User id: nil, name: &quot;DHH&quot;, created_at: nil, updated_at: nil&gt;
</code></pre>

<p>You can also pass a block to new with the new record as argument:</p>

<pre><code>user = users.new { |user| user.name = &#39;Oscar&#39; }
user.name # =&gt; Oscar
</code></pre>
            </div>
          

          
            <div class="aka">
              Also aliased as: <a href="Relation.html#method-i-build">build</a>
            </div>
          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-new_source">
                <pre><code class="ruby"><span class="ruby-comment"># File activerecord/lib/active_record/relation.rb, line 56</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">new</span>(<span class="ruby-identifier">attributes</span> = <span class="ruby-keyword">nil</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-identifier">scoping</span> { <span class="ruby-identifier">klass</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">values_for_create</span>(<span class="ruby-identifier">attributes</span>), <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>) }
<span class="ruby-keyword">end</span></code></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-none-3F">
            
              none?()
            
          </h3>

          
            <div class="description">
              <p>Returns true if there are no records.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-none-3F_source">
                <pre><code class="ruby"><span class="ruby-comment"># File activerecord/lib/active_record/relation.rb, line 221</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">none?</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">super</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">block_given?</span>
  <span class="ruby-identifier">empty?</span>
<span class="ruby-keyword">end</span></code></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-one-3F">
            
              one?()
            
          </h3>

          
            <div class="description">
              <p>Returns true if there is exactly one record.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-one-3F_source">
                <pre><code class="ruby"><span class="ruby-comment"># File activerecord/lib/active_record/relation.rb, line 233</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">one?</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">super</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">block_given?</span>
  <span class="ruby-identifier">limit_value</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">records</span>.<span class="ruby-identifier">one?</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span>
<span class="ruby-keyword">end</span></code></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-pretty_print">
            
              pretty_print(q)
            
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-pretty_print_source">
                <pre><code class="ruby"><span class="ruby-comment"># File activerecord/lib/active_record/relation.rb, line 498</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">pretty_print</span>(<span class="ruby-identifier">q</span>)
  <span class="ruby-identifier">q</span>.<span class="ruby-identifier">pp</span>(<span class="ruby-identifier">records</span>)
<span class="ruby-keyword">end</span></code></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-reload">
            
              reload()
            
          </h3>

          
            <div class="description">
              <p>Forces reloading of relation.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-reload_source">
                <pre><code class="ruby"><span class="ruby-comment"># File activerecord/lib/active_record/relation.rb, line 428</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">reload</span>
  <span class="ruby-identifier">reset</span>
  <span class="ruby-identifier">load</span>
<span class="ruby-keyword">end</span></code></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-reset">
            
              reset()
            
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-reset_source">
                <pre><code class="ruby"><span class="ruby-comment"># File activerecord/lib/active_record/relation.rb, line 433</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">reset</span>
  <span class="ruby-ivar">@delegate_to_klass</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-ivar">@to_sql</span> = <span class="ruby-ivar">@arel</span> = <span class="ruby-ivar">@loaded</span> = <span class="ruby-ivar">@should_eager_load</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-ivar">@records</span> = [].<span class="ruby-identifier">freeze</span>
  <span class="ruby-ivar">@offsets</span> = {}
  <span class="ruby-keyword">self</span>
<span class="ruby-keyword">end</span></code></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-scope_for_create">
            
              scope_for_create()
            
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-scope_for_create_source">
                <pre><code class="ruby"><span class="ruby-comment"># File activerecord/lib/active_record/relation.rb, line 467</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">scope_for_create</span>
  <span class="ruby-identifier">where_values_hash</span>.<span class="ruby-identifier">merge!</span>(<span class="ruby-identifier">create_with_value</span>.<span class="ruby-identifier">stringify_keys</span>)
<span class="ruby-keyword">end</span></code></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-scoping">
            
              scoping()
            
          </h3>

          
            <div class="description">
              <p>Scope all queries to the current scope.</p>

<pre><code>Comment.where(post_id: 1).scoping do
  Comment.first
end
# =&gt; SELECT &quot;comments&quot;.* FROM &quot;comments&quot; WHERE &quot;comments&quot;.&quot;post_id&quot; = 1 ORDER BY &quot;comments&quot;.&quot;id&quot; ASC LIMIT 1
</code></pre>

<p>Please check unscoped if you want to remove all previous scopes (including the default_scope) during the execution of a block.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-scoping_source">
                <pre><code class="ruby"><span class="ruby-comment"># File activerecord/lib/active_record/relation.rb, line 279</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">scoping</span>
  <span class="ruby-identifier">previous</span>, <span class="ruby-identifier">klass</span>.<span class="ruby-identifier">current_scope</span> = <span class="ruby-identifier">klass</span>.<span class="ruby-identifier">current_scope</span>(<span class="ruby-keyword">true</span>), <span class="ruby-keyword">self</span> <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@delegate_to_klass</span>
  <span class="ruby-keyword">yield</span>
<span class="ruby-keyword">ensure</span>
  <span class="ruby-identifier">klass</span>.<span class="ruby-identifier">current_scope</span> = <span class="ruby-identifier">previous</span> <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@delegate_to_klass</span>
<span class="ruby-keyword">end</span></code></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-size">
            
              size()
            
          </h3>

          
            <div class="description">
              <p>Returns size of the records.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-size_source">
                <pre><code class="ruby"><span class="ruby-comment"># File activerecord/lib/active_record/relation.rb, line 210</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">size</span>
  <span class="ruby-identifier">loaded?</span> <span class="ruby-operator">?</span> <span class="ruby-ivar">@records</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">count</span>(<span class="ruby-value">:all</span>)
<span class="ruby-keyword">end</span></code></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-to_a">
            
              to_a()
            
          </h3>

          
            <div class="description">
              
            </div>
          

          

          
            <div class="aka">
              Alias for: <a href="Relation.html#method-i-to_ary">to_ary</a>
            </div>
          

          
          </div>
        
        <div class="method">
          <h3 id="method-i-to_ary">
            
              to_ary()
            
          </h3>

          
            <div class="description">
              <p>Converts relation objects to <a href="../Array.html"><code>Array</code></a>.</p>
            </div>
          

          
            <div class="aka">
              Also aliased as: <a href="Relation.html#method-i-to_a">to_a</a>
            </div>
          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-to_ary_source">
                <pre><code class="ruby"><span class="ruby-comment"># File activerecord/lib/active_record/relation.rb, line 194</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">to_ary</span>
  <span class="ruby-identifier">records</span>.<span class="ruby-identifier">dup</span>
<span class="ruby-keyword">end</span></code></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-to_sql">
            
              to_sql()
            
          </h3>

          
            <div class="description">
              <p>Returns sql statement for the relation.</p>

<pre><code>User.where(name: &#39;Oscar&#39;).to_sql
# =&gt; SELECT &quot;users&quot;.* FROM &quot;users&quot;  WHERE &quot;users&quot;.&quot;name&quot; = &#39;Oscar&#39;
</code></pre>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-to_sql_source">
                <pre><code class="ruby"><span class="ruby-comment"># File activerecord/lib/active_record/relation.rb, line 445</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">to_sql</span>
  <span class="ruby-ivar">@to_sql</span> <span class="ruby-operator">||=</span> <span class="ruby-keyword">begin</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">eager_loading?</span>
      <span class="ruby-identifier">apply_join_dependency</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">relation</span>, <span class="ruby-identifier">join_dependency</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">relation</span> = <span class="ruby-identifier">join_dependency</span>.<span class="ruby-identifier">apply_column_aliases</span>(<span class="ruby-identifier">relation</span>)
        <span class="ruby-identifier">relation</span>.<span class="ruby-identifier">to_sql</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">conn</span> = <span class="ruby-identifier">klass</span>.<span class="ruby-identifier">connection</span>
      <span class="ruby-identifier">conn</span>.<span class="ruby-identifier">unprepared_statement</span> { <span class="ruby-identifier">conn</span>.<span class="ruby-identifier">to_sql</span>(<span class="ruby-identifier">arel</span>) }
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></code></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-update_all">
            
              update_all(updates)
            
          </h3>

          
            <div class="description">
              <p>Updates all records in the current relation with details given. This method constructs a single SQL UPDATE statement and sends it straight to the database. It does not instantiate the involved models and it does not trigger Active Record callbacks or validations. However, values passed to <a href="Relation.html#method-i-update_all"><code>update_all</code></a> will still go through Active Record&#39;s normal type casting and serialization.</p>

<h4 id="method-i-update_all-label-Parameters">Parameters</h4>
<ul><li>
<p><code>updates</code> - A string, array, or hash representing the SET part of an SQL statement.</p>
</li></ul>

<h4 id="method-i-update_all-label-Examples">Examples</h4>

<pre><code># Update all customers with the given attributes
Customer.update_all wants_email: true

# Update all books with &#39;Rails&#39; in their title
Book.where(&#39;title LIKE ?&#39;, &#39;%Rails%&#39;).update_all(author: &#39;David&#39;)

# Update all books that match conditions, but limit it to 5 ordered by date
Book.where(&#39;title LIKE ?&#39;, &#39;%Rails%&#39;).order(:created_at).limit(5).update_all(author: &#39;David&#39;)

# Update all invoices and set the number column to its id value.
Invoice.update_all(&#39;number = id&#39;)
</code></pre>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-update_all_source">
                <pre><code class="ruby"><span class="ruby-comment"># File activerecord/lib/active_record/relation.rb, line 315</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">update_all</span>(<span class="ruby-identifier">updates</span>)
  <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-string">&quot;Empty list of attributes to change&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">updates</span>.<span class="ruby-identifier">blank?</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">eager_loading?</span>
    <span class="ruby-identifier">relation</span> = <span class="ruby-identifier">apply_join_dependency</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">relation</span>.<span class="ruby-identifier">update_all</span>(<span class="ruby-identifier">updates</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">stmt</span> = <span class="ruby-constant">Arel</span><span class="ruby-operator">::</span><span class="ruby-constant">UpdateManager</span>.<span class="ruby-identifier">new</span>

  <span class="ruby-identifier">stmt</span>.<span class="ruby-identifier">set</span> <span class="ruby-constant">Arel</span>.<span class="ruby-identifier">sql</span>(<span class="ruby-ivar">@klass</span>.<span class="ruby-identifier">sanitize_sql_for_assignment</span>(<span class="ruby-identifier">updates</span>))
  <span class="ruby-identifier">stmt</span>.<span class="ruby-identifier">table</span>(<span class="ruby-identifier">table</span>)

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">has_join_values?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">offset_value</span>
    <span class="ruby-ivar">@klass</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">join_to_update</span>(<span class="ruby-identifier">stmt</span>, <span class="ruby-identifier">arel</span>, <span class="ruby-identifier">arel_attribute</span>(<span class="ruby-identifier">primary_key</span>))
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">stmt</span>.<span class="ruby-identifier">key</span> = <span class="ruby-identifier">arel_attribute</span>(<span class="ruby-identifier">primary_key</span>)
    <span class="ruby-identifier">stmt</span>.<span class="ruby-identifier">take</span>(<span class="ruby-identifier">arel</span>.<span class="ruby-identifier">limit</span>)
    <span class="ruby-identifier">stmt</span>.<span class="ruby-identifier">order</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">arel</span>.<span class="ruby-identifier">orders</span>)
    <span class="ruby-identifier">stmt</span>.<span class="ruby-identifier">wheres</span> = <span class="ruby-identifier">arel</span>.<span class="ruby-identifier">constraints</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-ivar">@klass</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">update</span> <span class="ruby-identifier">stmt</span>, <span class="ruby-node">&quot;#{@klass} Update All&quot;</span>
<span class="ruby-keyword">end</span></code></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-values">
            
              values()
            
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-values_source">
                <pre><code class="ruby"><span class="ruby-comment"># File activerecord/lib/active_record/relation.rb, line 507</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">values</span>
  <span class="ruby-ivar">@values</span>.<span class="ruby-identifier">dup</span>
<span class="ruby-keyword">end</span></code></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-where_values_hash">
            
              where_values_hash(relation_table_name = klass.table_name)
            
          </h3>

          
            <div class="description">
              <p>Returns a hash of where conditions.</p>

<pre><code>User.where(name: &#39;Oscar&#39;).where_values_hash
# =&gt; {name: &quot;Oscar&quot;}
</code></pre>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-where_values_hash_source">
                <pre><code class="ruby"><span class="ruby-comment"># File activerecord/lib/active_record/relation.rb, line 463</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">where_values_hash</span>(<span class="ruby-identifier">relation_table_name</span> = <span class="ruby-identifier">klass</span>.<span class="ruby-identifier">table_name</span>)
  <span class="ruby-identifier">where_clause</span>.<span class="ruby-identifier">to_h</span>(<span class="ruby-identifier">relation_table_name</span>)
<span class="ruby-keyword">end</span></code></pre>
              </div>
            </div>
            
          </div>
        
      
      <h2 id="instance-protected-methods">Instance Protected methods</h2>
      
        <div class="method">
          <h3 id="method-i-load_records">
            
              load_records(records)
            
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-load_records_source">
                <pre><code class="ruby"><span class="ruby-comment"># File activerecord/lib/active_record/relation.rb, line 535</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">load_records</span>(<span class="ruby-identifier">records</span>)
  <span class="ruby-ivar">@records</span> = <span class="ruby-identifier">records</span>.<span class="ruby-identifier">freeze</span>
  <span class="ruby-ivar">@loaded</span> = <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span></code></pre>
              </div>
            </div>
            
          </div>
        
      
    
  
</div>

    </div>
</div>
