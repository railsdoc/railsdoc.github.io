---
title: ActiveRecord::Associations::CollectionProxy
layout: default
---
<div class="main">
    <div class="banner">
        
            <span>Ruby on Rails 5.2.3</span><br />
        
        <div class="type">Class</div>
        <h1>
            ActiveRecord::Associations::CollectionProxy
            
                <span class="parent">&lt;
                    
                    Relation
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../../../files/activerecord/lib/active_record/associations/collection_proxy_rb.html">activerecord/lib/active_record/associations/collection_proxy.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
  
    <div class="description">
      
<p>Association proxies in Active Record are middlemen between the object that holds the association, known as the <code>@owner</code>, and the actual associated object, known as the <code>@target</code>. The kind of association any proxy is about is available in <code>@reflection</code>. That&#39;s an instance of the class ActiveRecord::Reflection::AssociationReflection.</p>

<p>For example, given</p>

<pre><code>class Blog &lt; ActiveRecord::Base
  has_many :posts
end

blog = Blog.first
</code></pre>

<p>the association proxy in <code>blog.posts</code> has the object in <code>blog</code> as <code>@owner</code>, the collection of its posts as <code>@target</code>, and the <code>@reflection</code> object represents a <code>:has_many</code> macro.</p>

<p>This class delegates unknown methods to <code>@target</code> via <code>method_missing</code>.</p>

<p>The <code>@target</code> object is not loaded until needed. For example,</p>

<pre><code>blog.posts.count
</code></pre>

<p>is computed directly through SQL and does not trigger by itself the instantiation of the actual post records.</p>

    </div>
  

  

  
  


  

  
    <!-- Method ref -->
    <h2 id="methods">Methods</h2>
    <dl class="methods">
      
        <dt>#</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-3C-3C">&lt;&lt;</a>,
              </li>
            
              
              <li>
                <a href="#method-i-3D-3D">==</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>A</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-any-3F">any?</a>,
              </li>
            
              
              <li>
                <a href="#method-i-append">append</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>B</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-build">build</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>C</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-calculate">calculate</a>,
              </li>
            
              
              <li>
                <a href="#method-i-clear">clear</a>,
              </li>
            
              
              <li>
                <a href="#method-i-concat">concat</a>,
              </li>
            
              
              <li>
                <a href="#method-i-count">count</a>,
              </li>
            
              
              <li>
                <a href="#method-i-create">create</a>,
              </li>
            
              
              <li>
                <a href="#method-i-create-21">create!</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>D</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-delete">delete</a>,
              </li>
            
              
              <li>
                <a href="#method-i-delete_all">delete_all</a>,
              </li>
            
              
              <li>
                <a href="#method-i-destroy">destroy</a>,
              </li>
            
              
              <li>
                <a href="#method-i-destroy_all">destroy_all</a>,
              </li>
            
              
              <li>
                <a href="#method-i-distinct">distinct</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>E</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-empty-3F">empty?</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>F</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-fifth">fifth</a>,
              </li>
            
              
              <li>
                <a href="#method-i-find">find</a>,
              </li>
            
              
              <li>
                <a href="#method-i-first">first</a>,
              </li>
            
              
              <li>
                <a href="#method-i-forty_two">forty_two</a>,
              </li>
            
              
              <li>
                <a href="#method-i-fourth">fourth</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>I</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-include-3F">include?</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>L</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-last">last</a>,
              </li>
            
              
              <li>
                <a href="#method-i-length">length</a>,
              </li>
            
              
              <li>
                <a href="#method-i-load_target">load_target</a>,
              </li>
            
              
              <li>
                <a href="#method-i-loaded-3F">loaded?</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>M</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-many-3F">many?</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>N</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-new">new</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>P</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-pluck">pluck</a>,
              </li>
            
              
              <li>
                <a href="#method-i-prepend">prepend</a>,
              </li>
            
              
              <li>
                <a href="#method-i-proxy_association">proxy_association</a>,
              </li>
            
              
              <li>
                <a href="#method-i-push">push</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>R</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-reload">reload</a>,
              </li>
            
              
              <li>
                <a href="#method-i-replace">replace</a>,
              </li>
            
              
              <li>
                <a href="#method-i-reset">reset</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>S</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-scope">scope</a>,
              </li>
            
              
              <li>
                <a href="#method-i-second">second</a>,
              </li>
            
              
              <li>
                <a href="#method-i-second_to_last">second_to_last</a>,
              </li>
            
              
              <li>
                <a href="#method-i-select">select</a>,
              </li>
            
              
              <li>
                <a href="#method-i-size">size</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>T</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-take">take</a>,
              </li>
            
              
              <li>
                <a href="#method-i-target">target</a>,
              </li>
            
              
              <li>
                <a href="#method-i-third">third</a>,
              </li>
            
              
              <li>
                <a href="#method-i-third_to_last">third_to_last</a>
              </li>
            
          </ul>
        </dd>
      
    </dl>
  

  

  
    

    

    

    

    <!-- Methods -->
    
    
      <h2 id="instance-public-methods">Instance Public methods</h2>
      
        <div class="method">
          <h3 id="method-i-3C-3C">
            
              &lt;&lt;(*records)
            
          </h3>

          
            <div class="description">
              <p>Adds one or more <code>records</code> to the collection by setting their foreign keys to the association&#39;s primary key. Since +&lt;&lt;+ flattens its argument list and inserts each record, <code>push</code> and <code>concat</code> behave identically. Returns <code>self</code> so several appends may be chained together.</p>

<pre><code>class Person &lt; ActiveRecord::Base
  has_many :pets
end

person.pets.size # =&gt; 0
person.pets &lt;&lt; Pet.new(name: &#39;Fancy-Fancy&#39;)
person.pets &lt;&lt; [Pet.new(name: &#39;Spook&#39;), Pet.new(name: &#39;Choo-Choo&#39;)]
person.pets.size # =&gt; 3

person.id # =&gt; 1
person.pets
# =&gt; [
#      #&lt;Pet id: 1, name: &quot;Fancy-Fancy&quot;, person_id: 1&gt;,
#      #&lt;Pet id: 2, name: &quot;Spook&quot;, person_id: 1&gt;,
#      #&lt;Pet id: 3, name: &quot;Choo-Choo&quot;, person_id: 1&gt;
#    ]
</code></pre>
            </div>
          

          
            <div class="aka">
              Also aliased as: <a href="CollectionProxy.html#method-i-push">push</a>, <a href="CollectionProxy.html#method-i-append">append</a>, <a href="CollectionProxy.html#method-i-concat">concat</a>
            </div>
          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-3C-3C_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/lib/active_record/associations/collection_proxy.rb, line 1028</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">&lt;&lt;</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">records</span>)
  <span class="ruby-identifier">proxy_association</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-identifier">records</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword">self</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-3D-3D">
            
              ==(other)
            
          </h3>

          
            <div class="description">
              <p>Equivalent to <code>Array#==</code>. Returns <code>true</code> if the two arrays contain the same number of elements and if each element is equal to the corresponding element in the <code>other</code> array, otherwise returns <code>false</code>.</p>

<pre><code>class Person &lt; ActiveRecord::Base
  has_many :pets
end

person.pets
# =&gt; [
#      #&lt;Pet id: 1, name: &quot;Fancy-Fancy&quot;, person_id: 1&gt;,
#      #&lt;Pet id: 2, name: &quot;Spook&quot;, person_id: 1&gt;
#    ]

other = person.pets.to_ary

person.pets == other
# =&gt; true

other = [Pet.new(id: 1), Pet.new(id: 2)]

person.pets == other
# =&gt; false
</code></pre>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-3D-3D_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/lib/active_record/associations/collection_proxy.rb, line 959</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">==</span>(<span class="ruby-identifier">other</span>)
  <span class="ruby-identifier">load_target</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">other</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-any-3F">
            
              any?()

            
          </h3>

          
            <div class="description">
              <p>Returns <code>true</code> if the collection is not empty.</p>

<pre><code>class Person &lt; ActiveRecord::Base
  has_many :pets
end

person.pets.count # =&gt; 0
person.pets.any?  # =&gt; false

person.pets &lt;&lt; Pet.new(name: &#39;Snoop&#39;)
person.pets.count # =&gt; 1
person.pets.any?  # =&gt; true
</code></pre>

<p>You can also pass a <code>block</code> to define criteria. The behavior is the same, it returns true if the collection based on the criteria is not empty.</p>

<pre><code>person.pets
# =&gt; [#&lt;Pet name: &quot;Snoop&quot;, group: &quot;dogs&quot;&gt;]

person.pets.any? do |pet|
  pet.group == &#39;cats&#39;
end
# =&gt; false

person.pets.any? do |pet|
  pet.group == &#39;dogs&#39;
end
# =&gt; true
</code></pre>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-any-3F_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/lib/active_record/associations/collection_proxy.rb, line 871</span>
      </pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-append">
            
              append(*records)
            
          </h3>

          
            <div class="description">
              
            </div>
          

          

          
            <div class="aka">
              Alias for: <a href="CollectionProxy.html#method-i-3C-3C">&lt;&lt;</a>
            </div>
          

          
          </div>
        
        <div class="method">
          <h3 id="method-i-build">
            
              build(attributes = {}, &amp;block)
            
          </h3>

          
            <div class="description">
              <p>Returns a new object of the collection type that has been instantiated with <code>attributes</code> and linked to this object, but have not yet been saved. You can pass an array of attributes hashes, this will return an array with the new objects.</p>

<pre><code>class Person
  has_many :pets
end

person.pets.build
# =&gt; #&lt;Pet id: nil, name: nil, person_id: 1&gt;

person.pets.build(name: &#39;Fancy-Fancy&#39;)
# =&gt; #&lt;Pet id: nil, name: &quot;Fancy-Fancy&quot;, person_id: 1&gt;

person.pets.build([{name: &#39;Spook&#39;}, {name: &#39;Choo-Choo&#39;}, {name: &#39;Brain&#39;}])
# =&gt; [
#      #&lt;Pet id: nil, name: &quot;Spook&quot;, person_id: 1&gt;,
#      #&lt;Pet id: nil, name: &quot;Choo-Choo&quot;, person_id: 1&gt;,
#      #&lt;Pet id: nil, name: &quot;Brain&quot;, person_id: 1&gt;
#    ]

person.pets.size  # =&gt; 5 # size of the collection
person.pets.count # =&gt; 0 # count from database
</code></pre>
            </div>
          

          
            <div class="aka">
              Also aliased as: <a href="CollectionProxy.html#method-i-new">new</a>
            </div>
          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-build_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/lib/active_record/associations/collection_proxy.rb, line 318</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">build</span>(<span class="ruby-identifier">attributes</span> = {}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-ivar">@association</span>.<span class="ruby-identifier">build</span>(<span class="ruby-identifier">attributes</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-calculate">
            
              calculate(operation, column_name)
            
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-calculate_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/lib/active_record/associations/collection_proxy.rb, line 724</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">calculate</span>(<span class="ruby-identifier">operation</span>, <span class="ruby-identifier">column_name</span>)
  <span class="ruby-identifier">null_scope?</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">scope</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">operation</span>, <span class="ruby-identifier">column_name</span>) <span class="ruby-operator">:</span> <span class="ruby-keyword">super</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-clear">
            
              clear()
            
          </h3>

          
            <div class="description">
              <p>Equivalent to <code>delete_all</code>. The difference is that returns <code>self</code>, instead of an array with the deleted objects, so methods can be chained. See <code>delete_all</code> for more information. Note that because <code>delete_all</code> removes records by directly running an SQL query into the database, the <code>updated_at</code> column of the object is not changed.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-clear_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/lib/active_record/associations/collection_proxy.rb, line 1045</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">clear</span>
  <span class="ruby-identifier">delete_all</span>
  <span class="ruby-keyword">self</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-concat">
            
              concat(*records)
            
          </h3>

          
            <div class="description">
              
            </div>
          

          

          
            <div class="aka">
              Alias for: <a href="CollectionProxy.html#method-i-3C-3C">&lt;&lt;</a>
            </div>
          

          
          </div>
        
        <div class="method">
          <h3 id="method-i-count">
            
              count(column_name = nil, &block)

            
          </h3>

          
            <div class="description">
              <p>Count all records.</p>

<pre><code>class Person &lt; ActiveRecord::Base
  has_many :pets
end

# This will perform the count using SQL.
person.pets.count # =&gt; 3
person.pets
# =&gt; [
#       #&lt;Pet id: 1, name: &quot;Fancy-Fancy&quot;, person_id: 1&gt;,
#       #&lt;Pet id: 2, name: &quot;Spook&quot;, person_id: 1&gt;,
#       #&lt;Pet id: 3, name: &quot;Choo-Choo&quot;, person_id: 1&gt;
#    ]
</code></pre>

<p>Passing a block will select all of a person&#39;s pets in SQL and then perform the count using Ruby.</p>

<pre><code>person.pets.count { |pet| pet.name.include?(&#39;-&#39;) } # =&gt; 2
</code></pre>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-count_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/lib/active_record/associations/collection_proxy.rb, line 758</span>
      </pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-create">
            
              create(attributes = {}, &amp;block)
            
          </h3>

          
            <div class="description">
              <p>Returns a new object of the collection type that has been instantiated with attributes, linked to this object and that has already been saved (if it passes the validations).</p>

<pre><code>class Person
  has_many :pets
end

person.pets.create(name: &#39;Fancy-Fancy&#39;)
# =&gt; #&lt;Pet id: 1, name: &quot;Fancy-Fancy&quot;, person_id: 1&gt;

person.pets.create([{name: &#39;Spook&#39;}, {name: &#39;Choo-Choo&#39;}])
# =&gt; [
#      #&lt;Pet id: 2, name: &quot;Spook&quot;, person_id: 1&gt;,
#      #&lt;Pet id: 3, name: &quot;Choo-Choo&quot;, person_id: 1&gt;
#    ]

person.pets.size  # =&gt; 3
person.pets.count # =&gt; 3

person.pets.find(1, 2, 3)
# =&gt; [
#       #&lt;Pet id: 1, name: &quot;Fancy-Fancy&quot;, person_id: 1&gt;,
#       #&lt;Pet id: 2, name: &quot;Spook&quot;, person_id: 1&gt;,
#       #&lt;Pet id: 3, name: &quot;Choo-Choo&quot;, person_id: 1&gt;
#    ]
</code></pre>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-create_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/lib/active_record/associations/collection_proxy.rb, line 349</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">create</span>(<span class="ruby-identifier">attributes</span> = {}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-ivar">@association</span>.<span class="ruby-identifier">create</span>(<span class="ruby-identifier">attributes</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-create-21">
            
              create!(attributes = {}, &amp;block)
            
          </h3>

          
            <div class="description">
              <p>Like <a href="CollectionProxy.html#method-i-create"><code>create</code></a>, except that if the record is invalid, raises an exception.</p>

<pre><code>class Person
  has_many :pets
end

class Pet
  validates :name, presence: true
end

person.pets.create!(name: nil)
# =&gt; ActiveRecord::RecordInvalid: Validation failed: Name can&#39;t be blank
</code></pre>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-create-21_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/lib/active_record/associations/collection_proxy.rb, line 365</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">create!</span>(<span class="ruby-identifier">attributes</span> = {}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-ivar">@association</span>.<span class="ruby-identifier">create!</span>(<span class="ruby-identifier">attributes</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-delete">
            
              delete(*records)
            
          </h3>

          
            <div class="description">
              <p>Deletes the <code>records</code> supplied from the collection according to the strategy specified by the <code>:dependent</code> option. If no <code>:dependent</code> option is given, then it will follow the default strategy. Returns an array with the deleted records.</p>

<p>For <code>has_many :through</code> associations, the default deletion strategy is <code>:delete_all</code>.</p>

<p>For <code>has_many</code> associations, the default deletion strategy is <code>:nullify</code>. This sets the foreign keys to <code>NULL</code>.</p>

<pre><code>class Person &lt; ActiveRecord::Base
  has_many :pets # dependent: :nullify option by default
end

person.pets.size # =&gt; 3
person.pets
# =&gt; [
#       #&lt;Pet id: 1, name: &quot;Fancy-Fancy&quot;, person_id: 1&gt;,
#       #&lt;Pet id: 2, name: &quot;Spook&quot;, person_id: 1&gt;,
#       #&lt;Pet id: 3, name: &quot;Choo-Choo&quot;, person_id: 1&gt;
#    ]

person.pets.delete(Pet.find(1))
# =&gt; [#&lt;Pet id: 1, name: &quot;Fancy-Fancy&quot;, person_id: 1&gt;]

person.pets.size # =&gt; 2
person.pets
# =&gt; [
#       #&lt;Pet id: 2, name: &quot;Spook&quot;, person_id: 1&gt;,
#       #&lt;Pet id: 3, name: &quot;Choo-Choo&quot;, person_id: 1&gt;
#    ]

Pet.find(1)
# =&gt; #&lt;Pet id: 1, name: &quot;Fancy-Fancy&quot;, person_id: nil&gt;
</code></pre>

<p>If it is set to <code>:destroy</code> all the <code>records</code> are removed by calling their <code>destroy</code> method. See <code>destroy</code> for more information.</p>

<pre><code>class Person &lt; ActiveRecord::Base
  has_many :pets, dependent: :destroy
end

person.pets.size # =&gt; 3
person.pets
# =&gt; [
#       #&lt;Pet id: 1, name: &quot;Fancy-Fancy&quot;, person_id: 1&gt;,
#       #&lt;Pet id: 2, name: &quot;Spook&quot;, person_id: 1&gt;,
#       #&lt;Pet id: 3, name: &quot;Choo-Choo&quot;, person_id: 1&gt;
#    ]

person.pets.delete(Pet.find(1), Pet.find(3))
# =&gt; [
#       #&lt;Pet id: 1, name: &quot;Fancy-Fancy&quot;, person_id: 1&gt;,
#       #&lt;Pet id: 3, name: &quot;Choo-Choo&quot;, person_id: 1&gt;
#    ]

person.pets.size # =&gt; 1
person.pets
# =&gt; [#&lt;Pet id: 2, name: &quot;Spook&quot;, person_id: 1&gt;]

Pet.find(1, 3)
# =&gt; ActiveRecord::RecordNotFound: Couldn&#39;t find all Pets with &#39;id&#39;: (1, 3)
</code></pre>

<p>If it is set to <code>:delete_all</code>, all the <code>records</code> are deleted <strong>without</strong> calling their <code>destroy</code> method.</p>

<pre><code>class Person &lt; ActiveRecord::Base
  has_many :pets, dependent: :delete_all
end

person.pets.size # =&gt; 3
person.pets
# =&gt; [
#       #&lt;Pet id: 1, name: &quot;Fancy-Fancy&quot;, person_id: 1&gt;,
#       #&lt;Pet id: 2, name: &quot;Spook&quot;, person_id: 1&gt;,
#       #&lt;Pet id: 3, name: &quot;Choo-Choo&quot;, person_id: 1&gt;
#    ]

person.pets.delete(Pet.find(1))
# =&gt; [#&lt;Pet id: 1, name: &quot;Fancy-Fancy&quot;, person_id: 1&gt;]

person.pets.size # =&gt; 2
person.pets
# =&gt; [
#       #&lt;Pet id: 2, name: &quot;Spook&quot;, person_id: 1&gt;,
#       #&lt;Pet id: 3, name: &quot;Choo-Choo&quot;, person_id: 1&gt;
#    ]

Pet.find(1)
# =&gt; ActiveRecord::RecordNotFound: Couldn&#39;t find Pet with &#39;id&#39;=1
</code></pre>

<p>You can pass <code>Integer</code> or <code>String</code> values, it finds the records responding to the <code>id</code> and executes delete on them.</p>

<pre><code>class Person &lt; ActiveRecord::Base
  has_many :pets
end

person.pets.size # =&gt; 3
person.pets
# =&gt; [
#       #&lt;Pet id: 1, name: &quot;Fancy-Fancy&quot;, person_id: 1&gt;,
#       #&lt;Pet id: 2, name: &quot;Spook&quot;, person_id: 1&gt;,
#       #&lt;Pet id: 3, name: &quot;Choo-Choo&quot;, person_id: 1&gt;
#    ]

person.pets.delete(&quot;1&quot;)
# =&gt; [#&lt;Pet id: 1, name: &quot;Fancy-Fancy&quot;, person_id: 1&gt;]

person.pets.delete(2, 3)
# =&gt; [
#       #&lt;Pet id: 2, name: &quot;Spook&quot;, person_id: 1&gt;,
#       #&lt;Pet id: 3, name: &quot;Choo-Choo&quot;, person_id: 1&gt;
#    ]
</code></pre>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-delete_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/lib/active_record/associations/collection_proxy.rb, line 620</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">delete</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">records</span>)
  <span class="ruby-ivar">@association</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">records</span>).<span class="ruby-identifier">tap</span> { <span class="ruby-identifier">reset_scope</span> }
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-delete_all">
            
              delete_all(dependent = nil)
            
          </h3>

          
            <div class="description">
              <p>Deletes all the records from the collection according to the strategy specified by the <code>:dependent</code> option. If no <code>:dependent</code> option is given, then it will follow the default strategy.</p>

<p>For <code>has_many :through</code> associations, the default deletion strategy is <code>:delete_all</code>.</p>

<p>For <code>has_many</code> associations, the default deletion strategy is <code>:nullify</code>. This sets the foreign keys to <code>NULL</code>.</p>

<pre><code>class Person &lt; ActiveRecord::Base
  has_many :pets # dependent: :nullify option by default
end

person.pets.size # =&gt; 3
person.pets
# =&gt; [
#       #&lt;Pet id: 1, name: &quot;Fancy-Fancy&quot;, person_id: 1&gt;,
#       #&lt;Pet id: 2, name: &quot;Spook&quot;, person_id: 1&gt;,
#       #&lt;Pet id: 3, name: &quot;Choo-Choo&quot;, person_id: 1&gt;
#    ]

person.pets.delete_all
# =&gt; [
#       #&lt;Pet id: 1, name: &quot;Fancy-Fancy&quot;, person_id: 1&gt;,
#       #&lt;Pet id: 2, name: &quot;Spook&quot;, person_id: 1&gt;,
#       #&lt;Pet id: 3, name: &quot;Choo-Choo&quot;, person_id: 1&gt;
#    ]

person.pets.size # =&gt; 0
person.pets      # =&gt; []

Pet.find(1, 2, 3)
# =&gt; [
#       #&lt;Pet id: 1, name: &quot;Fancy-Fancy&quot;, person_id: nil&gt;,
#       #&lt;Pet id: 2, name: &quot;Spook&quot;, person_id: nil&gt;,
#       #&lt;Pet id: 3, name: &quot;Choo-Choo&quot;, person_id: nil&gt;
#    ]
</code></pre>

<p>Both <code>has_many</code> and <code>has_many :through</code> dependencies default to the <code>:delete_all</code> strategy if the <code>:dependent</code> option is set to <code>:destroy</code>. Records are not instantiated and callbacks will not be fired.</p>

<pre><code>class Person &lt; ActiveRecord::Base
  has_many :pets, dependent: :destroy
end

person.pets.size # =&gt; 3
person.pets
# =&gt; [
#       #&lt;Pet id: 1, name: &quot;Fancy-Fancy&quot;, person_id: 1&gt;,
#       #&lt;Pet id: 2, name: &quot;Spook&quot;, person_id: 1&gt;,
#       #&lt;Pet id: 3, name: &quot;Choo-Choo&quot;, person_id: 1&gt;
#    ]

person.pets.delete_all

Pet.find(1, 2, 3)
# =&gt; ActiveRecord::RecordNotFound: Couldn&#39;t find all Pets with &#39;id&#39;: (1, 2, 3)
</code></pre>

<p>If it is set to <code>:delete_all</code>, all the objects are deleted <strong>without</strong> calling their <code>destroy</code> method.</p>

<pre><code>class Person &lt; ActiveRecord::Base
  has_many :pets, dependent: :delete_all
end

person.pets.size # =&gt; 3
person.pets
# =&gt; [
#       #&lt;Pet id: 1, name: &quot;Fancy-Fancy&quot;, person_id: 1&gt;,
#       #&lt;Pet id: 2, name: &quot;Spook&quot;, person_id: 1&gt;,
#       #&lt;Pet id: 3, name: &quot;Choo-Choo&quot;, person_id: 1&gt;
#    ]

person.pets.delete_all

Pet.find(1, 2, 3)
# =&gt; ActiveRecord::RecordNotFound: Couldn&#39;t find all Pets with &#39;id&#39;: (1, 2, 3)
</code></pre>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-delete_all_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/lib/active_record/associations/collection_proxy.rb, line 474</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">delete_all</span>(<span class="ruby-identifier">dependent</span> = <span class="ruby-keyword">nil</span>)
  <span class="ruby-ivar">@association</span>.<span class="ruby-identifier">delete_all</span>(<span class="ruby-identifier">dependent</span>).<span class="ruby-identifier">tap</span> { <span class="ruby-identifier">reset_scope</span> }
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-destroy">
            
              destroy(*records)
            
          </h3>

          
            <div class="description">
              <p>Destroys the <code>records</code> supplied and removes them from the collection. This method will <em>always</em> remove record from the database ignoring the <code>:dependent</code> option. Returns an array with the removed records.</p>

<pre><code>class Person &lt; ActiveRecord::Base
  has_many :pets
end

person.pets.size # =&gt; 3
person.pets
# =&gt; [
#       #&lt;Pet id: 1, name: &quot;Fancy-Fancy&quot;, person_id: 1&gt;,
#       #&lt;Pet id: 2, name: &quot;Spook&quot;, person_id: 1&gt;,
#       #&lt;Pet id: 3, name: &quot;Choo-Choo&quot;, person_id: 1&gt;
#    ]

person.pets.destroy(Pet.find(1))
# =&gt; [#&lt;Pet id: 1, name: &quot;Fancy-Fancy&quot;, person_id: 1&gt;]

person.pets.size # =&gt; 2
person.pets
# =&gt; [
#       #&lt;Pet id: 2, name: &quot;Spook&quot;, person_id: 1&gt;,
#       #&lt;Pet id: 3, name: &quot;Choo-Choo&quot;, person_id: 1&gt;
#    ]

person.pets.destroy(Pet.find(2), Pet.find(3))
# =&gt; [
#       #&lt;Pet id: 2, name: &quot;Spook&quot;, person_id: 1&gt;,
#       #&lt;Pet id: 3, name: &quot;Choo-Choo&quot;, person_id: 1&gt;
#    ]

person.pets.size  # =&gt; 0
person.pets       # =&gt; []

Pet.find(1, 2, 3) # =&gt; ActiveRecord::RecordNotFound: Couldn&#39;t find all Pets with &#39;id&#39;: (1, 2, 3)
</code></pre>

<p>You can pass <code>Integer</code> or <code>String</code> values, it finds the records responding to the <code>id</code> and then deletes them from the database.</p>

<pre><code>person.pets.size # =&gt; 3
person.pets
# =&gt; [
#       #&lt;Pet id: 4, name: &quot;Benny&quot;, person_id: 1&gt;,
#       #&lt;Pet id: 5, name: &quot;Brain&quot;, person_id: 1&gt;,
#       #&lt;Pet id: 6, name: &quot;Boss&quot;,  person_id: 1&gt;
#    ]

person.pets.destroy(&quot;4&quot;)
# =&gt; #&lt;Pet id: 4, name: &quot;Benny&quot;, person_id: 1&gt;

person.pets.size # =&gt; 2
person.pets
# =&gt; [
#       #&lt;Pet id: 5, name: &quot;Brain&quot;, person_id: 1&gt;,
#       #&lt;Pet id: 6, name: &quot;Boss&quot;,  person_id: 1&gt;
#    ]

person.pets.destroy(5, 6)
# =&gt; [
#       #&lt;Pet id: 5, name: &quot;Brain&quot;, person_id: 1&gt;,
#       #&lt;Pet id: 6, name: &quot;Boss&quot;,  person_id: 1&gt;
#    ]

person.pets.size  # =&gt; 0
person.pets       # =&gt; []

Pet.find(4, 5, 6) # =&gt; ActiveRecord::RecordNotFound: Couldn&#39;t find all Pets with &#39;id&#39;: (4, 5, 6)
</code></pre>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-destroy_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/lib/active_record/associations/collection_proxy.rb, line 692</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">destroy</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">records</span>)
  <span class="ruby-ivar">@association</span>.<span class="ruby-identifier">destroy</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">records</span>).<span class="ruby-identifier">tap</span> { <span class="ruby-identifier">reset_scope</span> }
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-destroy_all">
            
              destroy_all()
            
          </h3>

          
            <div class="description">
              <p>Deletes the records of the collection directly from the database ignoring the <code>:dependent</code> option. Records are instantiated and it invokes <code>before_remove</code>, <code>after_remove</code> , <code>before_destroy</code> and <code>after_destroy</code> callbacks.</p>

<pre><code>class Person &lt; ActiveRecord::Base
  has_many :pets
end

person.pets.size # =&gt; 3
person.pets
# =&gt; [
#       #&lt;Pet id: 1, name: &quot;Fancy-Fancy&quot;, person_id: 1&gt;,
#       #&lt;Pet id: 2, name: &quot;Spook&quot;, person_id: 1&gt;,
#       #&lt;Pet id: 3, name: &quot;Choo-Choo&quot;, person_id: 1&gt;
#    ]

person.pets.destroy_all

person.pets.size # =&gt; 0
person.pets      # =&gt; []

Pet.find(1) # =&gt; Couldn&#39;t find Pet with id=1
</code></pre>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-destroy_all_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/lib/active_record/associations/collection_proxy.rb, line 501</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">destroy_all</span>
  <span class="ruby-ivar">@association</span>.<span class="ruby-identifier">destroy_all</span>.<span class="ruby-identifier">tap</span> { <span class="ruby-identifier">reset_scope</span> }
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-distinct">
            
              distinct(value = true)

            
          </h3>

          
            <div class="description">
              <p>Specifies whether the records should be unique or not.</p>

<pre><code>class Person &lt; ActiveRecord::Base
  has_many :pets
end

person.pets.select(:name)
# =&gt; [
#      #&lt;Pet name: &quot;Fancy-Fancy&quot;&gt;,
#      #&lt;Pet name: &quot;Fancy-Fancy&quot;&gt;
#    ]

person.pets.select(:name).distinct
# =&gt; [#&lt;Pet name: &quot;Fancy-Fancy&quot;&gt;]

person.pets.select(:name).distinct.distinct(false)
# =&gt; [
#      #&lt;Pet name: &quot;Fancy-Fancy&quot;&gt;,
#      #&lt;Pet name: &quot;Fancy-Fancy&quot;&gt;
#    ]
</code></pre>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-distinct_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/lib/active_record/associations/collection_proxy.rb, line 723</span>
      </pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-empty-3F">
            
              empty?()
            
          </h3>

          
            <div class="description">
              <p>Returns <code>true</code> if the collection is empty. If the collection has been loaded it is equivalent to <code>collection.size.zero?</code>. If the collection has not been loaded, it is equivalent to <code>!collection.exists?</code>. If the collection has not already been loaded and you are going to fetch the records anyway it is better to check <code>collection.length.zero?</code>.</p>

<pre><code>class Person &lt; ActiveRecord::Base
  has_many :pets
end

person.pets.count  # =&gt; 1
person.pets.empty? # =&gt; false

person.pets.delete_all

person.pets.count  # =&gt; 0
person.pets.empty? # =&gt; true
</code></pre>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-empty-3F_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/lib/active_record/associations/collection_proxy.rb, line 831</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">empty?</span>
  <span class="ruby-ivar">@association</span>.<span class="ruby-identifier">empty?</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-fifth">
            
              fifth()

            
          </h3>

          
            <div class="description">
              <p>Same as <a href="CollectionProxy.html#method-i-first"><code>first</code></a> except returns only the fifth record.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-fifth_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/lib/active_record/associations/collection_proxy.rb, line 208</span>
      </pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-find">
            
              find(*args)
            
          </h3>

          
            <div class="description">
              <p>Finds an object in the collection responding to the <code>id</code>. Uses the same rules as ActiveRecord::Base.find. Returns <a href="../RecordNotFound.html"><code>ActiveRecord::RecordNotFound</code></a> error if the object cannot be found.</p>

<pre><code>class Person &lt; ActiveRecord::Base
  has_many :pets
end

person.pets
# =&gt; [
#       #&lt;Pet id: 1, name: &quot;Fancy-Fancy&quot;, person_id: 1&gt;,
#       #&lt;Pet id: 2, name: &quot;Spook&quot;, person_id: 1&gt;,
#       #&lt;Pet id: 3, name: &quot;Choo-Choo&quot;, person_id: 1&gt;
#    ]

person.pets.find(1) # =&gt; #&lt;Pet id: 1, name: &quot;Fancy-Fancy&quot;, person_id: 1&gt;
person.pets.find(4) # =&gt; ActiveRecord::RecordNotFound: Couldn&#39;t find Pet with &#39;id&#39;=4

person.pets.find(2) { |pet| pet.name.downcase! }
# =&gt; #&lt;Pet id: 2, name: &quot;fancy-fancy&quot;, person_id: 1&gt;

person.pets.find(2, 3)
# =&gt; [
#       #&lt;Pet id: 2, name: &quot;Spook&quot;, person_id: 1&gt;,
#       #&lt;Pet id: 3, name: &quot;Choo-Choo&quot;, person_id: 1&gt;
#    ]
</code></pre>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-find_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/lib/active_record/associations/collection_proxy.rb, line 138</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">find</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">super</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">block_given?</span>
  <span class="ruby-ivar">@association</span>.<span class="ruby-identifier">find</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-first">
            
              first(limit = nil)

            
          </h3>

          
            <div class="description">
              <p>Returns the first record, or the first <code>n</code> records, from the collection. If the collection is empty, the first form returns <code>nil</code>, and the second form returns an empty array.</p>

<pre><code>class Person &lt; ActiveRecord::Base
  has_many :pets
end

person.pets
# =&gt; [
#       #&lt;Pet id: 1, name: &quot;Fancy-Fancy&quot;, person_id: 1&gt;,
#       #&lt;Pet id: 2, name: &quot;Spook&quot;, person_id: 1&gt;,
#       #&lt;Pet id: 3, name: &quot;Choo-Choo&quot;, person_id: 1&gt;
#    ]

person.pets.first # =&gt; #&lt;Pet id: 1, name: &quot;Fancy-Fancy&quot;, person_id: 1&gt;

person.pets.first(2)
# =&gt; [
#      #&lt;Pet id: 1, name: &quot;Fancy-Fancy&quot;, person_id: 1&gt;,
#      #&lt;Pet id: 2, name: &quot;Spook&quot;, person_id: 1&gt;
#    ]

another_person_without.pets          # =&gt; []
another_person_without.pets.first    # =&gt; nil
another_person_without.pets.first(3) # =&gt; []
</code></pre>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-first_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/lib/active_record/associations/collection_proxy.rb, line 176</span>
      </pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-forty_two">
            
              forty_two()

            
          </h3>

          
            <div class="description">
              <p>Same as <a href="CollectionProxy.html#method-i-first"><code>first</code></a> except returns only the forty second record. Also known as accessing “the reddit”.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-forty_two_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/lib/active_record/associations/collection_proxy.rb, line 217</span>
      </pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-fourth">
            
              fourth()

            
          </h3>

          
            <div class="description">
              <p>Same as <a href="CollectionProxy.html#method-i-first"><code>first</code></a> except returns only the fourth record.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-fourth_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/lib/active_record/associations/collection_proxy.rb, line 200</span>
      </pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-include-3F">
            
              include?(record)
            
          </h3>

          
            <div class="description">
              <p>Returns <code>true</code> if the given <code>record</code> is present in the collection.</p>

<pre><code>class Person &lt; ActiveRecord::Base
  has_many :pets
end

person.pets # =&gt; [#&lt;Pet id: 20, name: &quot;Snoop&quot;&gt;]

person.pets.include?(Pet.find(20)) # =&gt; true
person.pets.include?(Pet.find(21)) # =&gt; false
</code></pre>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-include-3F_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/lib/active_record/associations/collection_proxy.rb, line 922</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">include?</span>(<span class="ruby-identifier">record</span>)
  <span class="ruby-operator">!</span><span class="ruby-operator">!</span><span class="ruby-ivar">@association</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">record</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-last">
            
              last(limit = nil)
            
          </h3>

          
            <div class="description">
              <p>Returns the last record, or the last <code>n</code> records, from the collection. If the collection is empty, the first form returns <code>nil</code>, and the second form returns an empty array.</p>

<pre><code>class Person &lt; ActiveRecord::Base
  has_many :pets
end

person.pets
# =&gt; [
#       #&lt;Pet id: 1, name: &quot;Fancy-Fancy&quot;, person_id: 1&gt;,
#       #&lt;Pet id: 2, name: &quot;Spook&quot;, person_id: 1&gt;,
#       #&lt;Pet id: 3, name: &quot;Choo-Choo&quot;, person_id: 1&gt;
#    ]

person.pets.last # =&gt; #&lt;Pet id: 3, name: &quot;Choo-Choo&quot;, person_id: 1&gt;

person.pets.last(2)
# =&gt; [
#      #&lt;Pet id: 2, name: &quot;Spook&quot;, person_id: 1&gt;,
#      #&lt;Pet id: 3, name: &quot;Choo-Choo&quot;, person_id: 1&gt;
#    ]

another_person_without.pets         # =&gt; []
another_person_without.pets.last    # =&gt; nil
another_person_without.pets.last(3) # =&gt; []
</code></pre>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-last_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/lib/active_record/associations/collection_proxy.rb, line 259</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">last</span>(<span class="ruby-identifier">limit</span> = <span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">load_target</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">find_from_target?</span>
  <span class="ruby-keyword">super</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-length">
            
              length()

            
          </h3>

          
            <div class="description">
              <p>Returns the size of the collection calling <code>size</code> on the target. If the collection has been already loaded, <code>length</code> and <code>size</code> are equivalent. If not and you are going to need the records anyway this method will take one less query. Otherwise <code>size</code> is more efficient.</p>

<pre><code>class Person &lt; ActiveRecord::Base
  has_many :pets
end

person.pets.length # =&gt; 3
# executes something like SELECT &quot;pets&quot;.* FROM &quot;pets&quot; WHERE &quot;pets&quot;.&quot;person_id&quot; = 1

# Because the collection is loaded, you can
# call the collection with no additional queries:
person.pets
# =&gt; [
#       #&lt;Pet id: 1, name: &quot;Fancy-Fancy&quot;, person_id: 1&gt;,
#       #&lt;Pet id: 2, name: &quot;Spook&quot;, person_id: 1&gt;,
#       #&lt;Pet id: 3, name: &quot;Choo-Choo&quot;, person_id: 1&gt;
#    ]
</code></pre>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-length_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/lib/active_record/associations/collection_proxy.rb, line 813</span>
      </pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-load_target">
            
              load_target()
            
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-load_target_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/lib/active_record/associations/collection_proxy.rb, line 45</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">load_target</span>
  <span class="ruby-ivar">@association</span>.<span class="ruby-identifier">load_target</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-loaded-3F">
            
              loaded?()
            
          </h3>

          
            <div class="description">
              <p>Returns <code>true</code> if the association has been loaded, otherwise <code>false</code>.</p>

<pre><code>person.pets.loaded? # =&gt; false
person.pets
person.pets.loaded? # =&gt; true
</code></pre>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-loaded-3F_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/lib/active_record/associations/collection_proxy.rb, line 54</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">loaded?</span>
  <span class="ruby-ivar">@association</span>.<span class="ruby-identifier">loaded?</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-many-3F">
            
              many?()

            
          </h3>

          
            <div class="description">
              <p>Returns true if the collection has more than one record. Equivalent to <code>collection.size &gt; 1</code>.</p>

<pre><code>class Person &lt; ActiveRecord::Base
  has_many :pets
end

person.pets.count # =&gt; 1
person.pets.many? # =&gt; false

person.pets &lt;&lt; Pet.new(name: &#39;Snoopy&#39;)
person.pets.count # =&gt; 2
person.pets.many? # =&gt; true
</code></pre>

<p>You can also pass a <code>block</code> to define criteria. The behavior is the same, it returns true if the collection based on the criteria has more than one record.</p>

<pre><code>person.pets
# =&gt; [
#      #&lt;Pet name: &quot;Gorby&quot;, group: &quot;cats&quot;&gt;,
#      #&lt;Pet name: &quot;Puff&quot;, group: &quot;cats&quot;&gt;,
#      #&lt;Pet name: &quot;Snoop&quot;, group: &quot;dogs&quot;&gt;
#    ]

person.pets.many? do |pet|
  pet.group == &#39;dogs&#39;
end
# =&gt; false

person.pets.many? do |pet|
  pet.group == &#39;cats&#39;
end
# =&gt; true
</code></pre>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-many-3F_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/lib/active_record/associations/collection_proxy.rb, line 912</span>
      </pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-new">
            
              new(attributes = {}, &amp;block)
            
          </h3>

          
            <div class="description">
              
            </div>
          

          

          
            <div class="aka">
              Alias for: <a href="CollectionProxy.html#method-i-build">build</a>
            </div>
          

          
          </div>
        
        <div class="method">
          <h3 id="method-i-pluck">
            
              pluck(*column_names)
            
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-pluck_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/lib/active_record/associations/collection_proxy.rb, line 728</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">pluck</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">column_names</span>)
  <span class="ruby-identifier">null_scope?</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">scope</span>.<span class="ruby-identifier">pluck</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">column_names</span>) <span class="ruby-operator">:</span> <span class="ruby-keyword">super</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-prepend">
            
              prepend(*args)
            
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-prepend_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/lib/active_record/associations/collection_proxy.rb, line 1035</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">prepend</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
  <span class="ruby-identifier">raise</span> <span class="ruby-constant">NoMethodError</span>, <span class="ruby-string">&quot;prepend on association is not defined. Please use &lt;&lt;, push or append&quot;</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-proxy_association">
            
              proxy_association()
            
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-proxy_association_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/lib/active_record/associations/collection_proxy.rb, line 926</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">proxy_association</span>
  <span class="ruby-ivar">@association</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-push">
            
              push(*records)
            
          </h3>

          
            <div class="description">
              
            </div>
          

          

          
            <div class="aka">
              Alias for: <a href="CollectionProxy.html#method-i-3C-3C">&lt;&lt;</a>
            </div>
          

          
          </div>
        
        <div class="method">
          <h3 id="method-i-reload">
            
              reload()
            
          </h3>

          
            <div class="description">
              <p>Reloads the collection from the database. Returns <code>self</code>.</p>

<pre><code>class Person &lt; ActiveRecord::Base
  has_many :pets
end

person.pets # fetches pets from the database
# =&gt; [#&lt;Pet id: 1, name: &quot;Snoop&quot;, group: &quot;dogs&quot;, person_id: 1&gt;]

person.pets # uses the pets cache
# =&gt; [#&lt;Pet id: 1, name: &quot;Snoop&quot;, group: &quot;dogs&quot;, person_id: 1&gt;]

person.pets.reload # fetches pets from the database
# =&gt; [#&lt;Pet id: 1, name: &quot;Snoop&quot;, group: &quot;dogs&quot;, person_id: 1&gt;]
</code></pre>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-reload_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/lib/active_record/associations/collection_proxy.rb, line 1064</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">reload</span>
  <span class="ruby-identifier">proxy_association</span>.<span class="ruby-identifier">reload</span>
  <span class="ruby-identifier">reset_scope</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-replace">
            
              replace(other_array)
            
          </h3>

          
            <div class="description">
              <p>Replaces this collection with <code>other_array</code>. This will perform a diff and delete/add only records that have changed.</p>

<pre><code>class Person &lt; ActiveRecord::Base
  has_many :pets
end

person.pets
# =&gt; [#&lt;Pet id: 1, name: &quot;Gorby&quot;, group: &quot;cats&quot;, person_id: 1&gt;]

other_pets = [Pet.new(name: &#39;Puff&#39;, group: &#39;celebrities&#39;]

person.pets.replace(other_pets)

person.pets
# =&gt; [#&lt;Pet id: 2, name: &quot;Puff&quot;, group: &quot;celebrities&quot;, person_id: 1&gt;]
</code></pre>

<p>If the supplied array has an incorrect association type, it raises an <code>ActiveRecord::AssociationTypeMismatch</code> error:</p>

<pre><code>person.pets.replace([&quot;doo&quot;, &quot;ggie&quot;, &quot;gaga&quot;])
# =&gt; ActiveRecord::AssociationTypeMismatch: Pet expected, got String
</code></pre>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-replace_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/lib/active_record/associations/collection_proxy.rb, line 391</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">replace</span>(<span class="ruby-identifier">other_array</span>)
  <span class="ruby-ivar">@association</span>.<span class="ruby-identifier">replace</span>(<span class="ruby-identifier">other_array</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-reset">
            
              reset()
            
          </h3>

          
            <div class="description">
              <p>Unloads the association. Returns <code>self</code>.</p>

<pre><code>class Person &lt; ActiveRecord::Base
  has_many :pets
end

person.pets # fetches pets from the database
# =&gt; [#&lt;Pet id: 1, name: &quot;Snoop&quot;, group: &quot;dogs&quot;, person_id: 1&gt;]

person.pets # uses the pets cache
# =&gt; [#&lt;Pet id: 1, name: &quot;Snoop&quot;, group: &quot;dogs&quot;, person_id: 1&gt;]

person.pets.reset # clears the pets cache

person.pets  # fetches pets from the database
# =&gt; [#&lt;Pet id: 1, name: &quot;Snoop&quot;, group: &quot;dogs&quot;, person_id: 1&gt;]
</code></pre>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-reset_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/lib/active_record/associations/collection_proxy.rb, line 1085</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">reset</span>
  <span class="ruby-identifier">proxy_association</span>.<span class="ruby-identifier">reset</span>
  <span class="ruby-identifier">proxy_association</span>.<span class="ruby-identifier">reset_scope</span>
  <span class="ruby-identifier">reset_scope</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-scope">
            
              scope()
            
          </h3>

          
            <div class="description">
              <p>Returns a <code>Relation</code> object for the records in this association</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-scope_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/lib/active_record/associations/collection_proxy.rb, line 931</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">scope</span>
  <span class="ruby-ivar">@scope</span> <span class="ruby-operator">||=</span> <span class="ruby-ivar">@association</span>.<span class="ruby-identifier">scope</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-second">
            
              second()

            
          </h3>

          
            <div class="description">
              <p>Same as <a href="CollectionProxy.html#method-i-first"><code>first</code></a> except returns only the second record.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-second_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/lib/active_record/associations/collection_proxy.rb, line 184</span>
      </pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-second_to_last">
            
              second_to_last()

            
          </h3>

          
            <div class="description">
              <p>Same as <a href="CollectionProxy.html#method-i-first"><code>first</code></a> except returns only the second-to-last record.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-second_to_last_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/lib/active_record/associations/collection_proxy.rb, line 233</span>
      </pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-select">
            
              select(*fields, &block)

            
          </h3>

          
            <div class="description">
              <p>Works in two ways.</p>

<p><strong>First:</strong> Specify a subset of fields to be selected from the result set.</p>

<pre><code>class Person &lt; ActiveRecord::Base
  has_many :pets
end

person.pets
# =&gt; [
#       #&lt;Pet id: 1, name: &quot;Fancy-Fancy&quot;, person_id: 1&gt;,
#       #&lt;Pet id: 2, name: &quot;Spook&quot;, person_id: 1&gt;,
#       #&lt;Pet id: 3, name: &quot;Choo-Choo&quot;, person_id: 1&gt;
#    ]

person.pets.select(:name)
# =&gt; [
#      #&lt;Pet id: nil, name: &quot;Fancy-Fancy&quot;&gt;,
#      #&lt;Pet id: nil, name: &quot;Spook&quot;&gt;,
#      #&lt;Pet id: nil, name: &quot;Choo-Choo&quot;&gt;
#    ]

person.pets.select(:id, :name)
# =&gt; [
#      #&lt;Pet id: 1, name: &quot;Fancy-Fancy&quot;&gt;,
#      #&lt;Pet id: 2, name: &quot;Spook&quot;&gt;,
#      #&lt;Pet id: 3, name: &quot;Choo-Choo&quot;&gt;
#    ]
</code></pre>

<p>Be careful because this also means you&#39;re initializing a model object with only the fields that you&#39;ve selected. If you attempt to access a field except <code>id</code> that is not in the initialized record you&#39;ll receive:</p>

<pre><code>person.pets.select(:name).first.person_id
# =&gt; ActiveModel::MissingAttributeError: missing attribute: person_id
</code></pre>

<p><strong>Second:</strong> You can pass a block so it can be used just like Array#select. This builds an array of objects from the database for the scope, converting them into an array and iterating through them using Array#select.</p>

<pre><code>person.pets.select { |pet| pet.name =~ /oo/ }
# =&gt; [
#      #&lt;Pet id: 2, name: &quot;Spook&quot;, person_id: 1&gt;,
#      #&lt;Pet id: 3, name: &quot;Choo-Choo&quot;, person_id: 1&gt;
#    ]
</code></pre>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-select_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/lib/active_record/associations/collection_proxy.rb, line 112</span>
      </pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-size">
            
              size()
            
          </h3>

          
            <div class="description">
              <p>Returns the size of the collection. If the collection hasn&#39;t been loaded, it executes a <code>SELECT COUNT(*)</code> query. Else it calls <code>collection.size</code>.</p>

<p>If the collection has been already loaded <code>size</code> and <code>length</code> are equivalent. If not and you are going to need the records anyway <code>length</code> will take one less query. Otherwise <code>size</code> is more efficient.</p>

<pre><code>class Person &lt; ActiveRecord::Base
  has_many :pets
end

person.pets.size # =&gt; 3
# executes something like SELECT COUNT(*) FROM &quot;pets&quot; WHERE &quot;pets&quot;.&quot;person_id&quot; = 1

person.pets # This will execute a SELECT * FROM query
# =&gt; [
#       #&lt;Pet id: 1, name: &quot;Fancy-Fancy&quot;, person_id: 1&gt;,
#       #&lt;Pet id: 2, name: &quot;Spook&quot;, person_id: 1&gt;,
#       #&lt;Pet id: 3, name: &quot;Choo-Choo&quot;, person_id: 1&gt;
#    ]

person.pets.size # =&gt; 3
# Because the collection is already loaded, this will behave like
# collection.size and no SQL count query is executed.
</code></pre>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-size_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/lib/active_record/associations/collection_proxy.rb, line 782</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">size</span>
  <span class="ruby-ivar">@association</span>.<span class="ruby-identifier">size</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-take">
            
              take(limit = nil)
            
          </h3>

          
            <div class="description">
              <p>Gives a record (or N records if a parameter is supplied) from the collection using the same rules as <code>ActiveRecord::Base.take</code>.</p>

<pre><code>class Person &lt; ActiveRecord::Base
  has_many :pets
end

person.pets
# =&gt; [
#       #&lt;Pet id: 1, name: &quot;Fancy-Fancy&quot;, person_id: 1&gt;,
#       #&lt;Pet id: 2, name: &quot;Spook&quot;, person_id: 1&gt;,
#       #&lt;Pet id: 3, name: &quot;Choo-Choo&quot;, person_id: 1&gt;
#    ]

person.pets.take # =&gt; #&lt;Pet id: 1, name: &quot;Fancy-Fancy&quot;, person_id: 1&gt;

person.pets.take(2)
# =&gt; [
#      #&lt;Pet id: 1, name: &quot;Fancy-Fancy&quot;, person_id: 1&gt;,
#      #&lt;Pet id: 2, name: &quot;Spook&quot;, person_id: 1&gt;
#    ]

another_person_without.pets         # =&gt; []
another_person_without.pets.take    # =&gt; nil
another_person_without.pets.take(2) # =&gt; []
</code></pre>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-take_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/lib/active_record/associations/collection_proxy.rb, line 289</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">take</span>(<span class="ruby-identifier">limit</span> = <span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">load_target</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">find_from_target?</span>
  <span class="ruby-keyword">super</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-target">
            
              target()
            
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-target_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/lib/active_record/associations/collection_proxy.rb, line 41</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">target</span>
  <span class="ruby-ivar">@association</span>.<span class="ruby-identifier">target</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-third">
            
              third()

            
          </h3>

          
            <div class="description">
              <p>Same as <a href="CollectionProxy.html#method-i-first"><code>first</code></a> except returns only the third record.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-third_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/lib/active_record/associations/collection_proxy.rb, line 192</span>
      </pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-third_to_last">
            
              third_to_last()

            
          </h3>

          
            <div class="description">
              <p>Same as <a href="CollectionProxy.html#method-i-first"><code>first</code></a> except returns only the third-to-last record.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-third_to_last_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/lib/active_record/associations/collection_proxy.rb, line 225</span>
      </pre>
              </div>
            </div>
            
          </div>
        
      
    
  
</div>

    </div>
</div>
