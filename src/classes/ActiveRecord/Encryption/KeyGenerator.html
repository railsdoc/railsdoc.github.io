---
title: ActiveRecord::Encryption::KeyGenerator
layout: default
---
<div class="main">
    <div class="banner">
        
            <span>Ruby on Rails 7.1.0</span><br />
        
        <div class="type">Class</div>
        <h1>
            ActiveRecord::Encryption::KeyGenerator
            
                <span class="parent">&lt;
                    
                    <a href="../../Object.html">Object</a>
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../../../files/activerecord/lib/active_record/encryption/key_generator_rb.html">activerecord/lib/active_record/encryption/key_generator.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
  
    <div class="description">
      
<p>Utility for generating and deriving random keys.</p>

    </div>
  

  

  
  


  

  
    <h2 id="methods">Methods</h2>
    <ul>
      
        <li>
          <a href="#method-i-derive_key_from">derive_key_from</a>
        </li>
      
        <li>
          <a href="#method-i-generate_random_hex_key">generate_random_hex_key</a>
        </li>
      
        <li>
          <a href="#method-i-generate_random_key">generate_random_key</a>
        </li>
      
        <li>
          <a href="#method-c-new">new</a>
        </li>
      
    </ul>
  

  

  
    

    

    

    
      <!-- Section attributes -->
      <h2 id="attributes">Attributes</h2>
      <table border='0' cellpadding='5'>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [R]
            </td>
            <td class='attr-name'>hash_digest_class</td>
            <td class='attr-desc'></td>
          </tr>
        
      </table>
    

    <!-- Methods -->
    
      <h2 id="class-public-methods">Class Public methods</h2>
      
        <div class="method">
          <h3 id="method-c-new">
            
              new(hash_digest_class: ActiveRecord::Encryption.config.hash_digest_class)
            
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-c-new_source">
                <pre><code class="ruby"><span class="ruby-comment"># File activerecord/lib/active_record/encryption/key_generator.rb, line 11</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">initialize</span>(<span class="ruby-value">hash_digest_class:</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Encryption</span>.<span class="ruby-identifier">config</span>.<span class="ruby-identifier">hash_digest_class</span>)
  <span class="ruby-ivar">@hash_digest_class</span> = <span class="ruby-identifier">hash_digest_class</span>
<span class="ruby-keyword">end</span></code></pre>
              </div>
            </div>
            
          </div>
        
      
    
      <h2 id="instance-public-methods">Instance Public methods</h2>
      
        <div class="method">
          <h3 id="method-i-derive_key_from">
            
              derive_key_from(password, length: key_length)
            
          </h3>

          
            <div class="description">
              <p>Derives a key from the given password. The key will have a size in bytes of <code>:length</code> (configured <code>Cipher</code>‘s length by default)</p>

<p>The generated key will be salted with the value of <code>ActiveRecord::Encryption.key_derivation_salt</code></p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-derive_key_from_source">
                <pre><code class="ruby"><span class="ruby-comment"># File activerecord/lib/active_record/encryption/key_generator.rb, line 38</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">derive_key_from</span>(<span class="ruby-identifier">password</span>, <span class="ruby-value">length:</span> <span class="ruby-identifier">key_length</span>)
  <span class="ruby-constant">ActiveSupport</span><span class="ruby-operator">::</span><span class="ruby-constant">KeyGenerator</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">password</span>, <span class="ruby-value">hash_digest_class:</span> <span class="ruby-identifier">hash_digest_class</span>)
    .<span class="ruby-identifier">generate_key</span>(<span class="ruby-identifier">key_derivation_salt</span>, <span class="ruby-identifier">length</span>)
<span class="ruby-keyword">end</span></code></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-generate_random_hex_key">
            
              generate_random_hex_key(length: key_length)
            
          </h3>

          
            <div class="description">
              <p>Returns a random key in hexadecimal format. The key will have a size in bytes of <code>:length</code> (configured <code>Cipher</code>‘s length by default)</p>

<p>Hexadecimal format is handy for representing keys as printable text. To maximize the space of characters used, it is good practice including not printable characters. Hexadecimal format ensures that generated keys are representable with plain text</p>

<p>To convert back to the original string with the desired length:</p>

<pre><code>[ value ].pack(&quot;H*&quot;)
</code></pre>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-generate_random_hex_key_source">
                <pre><code class="ruby"><span class="ruby-comment"># File activerecord/lib/active_record/encryption/key_generator.rb, line 30</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">generate_random_hex_key</span>(<span class="ruby-value">length:</span> <span class="ruby-identifier">key_length</span>)
  <span class="ruby-identifier">generate_random_key</span>(<span class="ruby-value">length:</span> <span class="ruby-identifier">length</span>).<span class="ruby-identifier">unpack</span>(<span class="ruby-string">&quot;H*&quot;</span>)[<span class="ruby-value">0</span>]
<span class="ruby-keyword">end</span></code></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 id="method-i-generate_random_key">
            
              generate_random_key(length: key_length)
            
          </h3>

          
            <div class="description">
              <p>Returns a random key. The key will have a size in bytes of <code>:length</code> (configured <code>Cipher</code>‘s length by default)</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                
              </p>
              <div id="method-i-generate_random_key_source">
                <pre><code class="ruby"><span class="ruby-comment"># File activerecord/lib/active_record/encryption/key_generator.rb, line 16</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">generate_random_key</span>(<span class="ruby-value">length:</span> <span class="ruby-identifier">key_length</span>)
  <span class="ruby-constant">SecureRandom</span>.<span class="ruby-identifier">random_bytes</span>(<span class="ruby-identifier">length</span>)
<span class="ruby-keyword">end</span></code></pre>
              </div>
            </div>
            
          </div>
        
      
    
  
</div>

    </div>
</div>
