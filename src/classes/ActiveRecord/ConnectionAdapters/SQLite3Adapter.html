---
title: ActiveRecord::ConnectionAdapters::SQLite3Adapter
layout: default
---
<div class="main">
    <div class="banner">
        
            <span>Ruby on Rails 8.1.0</span><br />
        
        <div class="type">Class</div>
        <h1>
            ActiveRecord::ConnectionAdapters::SQLite3Adapter
            
                <span class="parent">&lt;
                    
                    <a href="AbstractAdapter.html">ActiveRecord::ConnectionAdapters::AbstractAdapter</a>
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../../../files/activerecord/lib/active_record/connection_adapters/sqlite3_adapter_rb.html">activerecord/lib/active_record/connection_adapters/sqlite3_adapter.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
  
    <div class="description">
      
<h1 id="class-ActiveRecord::ConnectionAdapters::SQLite3Adapter-label-Active+Record+SQLite3+Adapter">Active Record SQLite3 Adapter</h1>

<p>The SQLite3 adapter works with the <a href="https://sparklemotion.github.io/sqlite3-ruby/">sqlite3</a> driver.</p>

<h4 id="class-ActiveRecord::ConnectionAdapters::SQLite3Adapter-label-Options">Options</h4>
<ul><li>
<p><code>:database</code> (<a href="../../String.html"><code>String</code></a>): Filesystem path to the database file.</p>
</li><li>
<p><code>:statement_limit</code> (<a href="../../Integer.html"><code>Integer</code></a>): Maximum number of prepared statements to cache per database connection. (default: 1000)</p>
</li><li>
<p><code>:timeout</code> (<a href="../../Integer.html"><code>Integer</code></a>): Timeout in milliseconds to use when waiting for a lock. (default: no wait)</p>
</li><li>
<p><code>:strict</code> (Boolean): Enable or disable strict mode. When enabled, this will <a href="https://www.sqlite.org/quirks.html#double_quoted_string_literals_are_accepted">disallow double-quoted string literals in SQL statements</a>. (default: see <a href="SQLite3Adapter.html#method-c-strict_strings_by_default"><code>strict_strings_by_default</code></a>)</p>
</li><li>
<p><code>:extensions</code> (<a href="../../Array.html"><code>Array</code></a>): (<strong>requires sqlite3 v2.4.0</strong>) Each entry specifies a sqlite extension to load for this database. The entry may be a filesystem path, or the name of a class that responds to <code>.to_path</code> to provide the filesystem path for the extension. See <a href="https://sparklemotion.github.io/sqlite3-ruby/SQLite3/Database.html#class-SQLite3::Database-label-SQLite+Extensions">sqlite3-ruby documentation</a> for more information.</p>
</li></ul>

<p>There may be other options available specific to the <a href="SQLite3.html"><code>SQLite3</code></a> driver. Please read the documentation for <a href="https://sparklemotion.github.io/sqlite3-ruby/SQLite3/Database.html#method-c-new">SQLite3::Database.new</a></p>

    </div>
  

  

  
  


  

  
    <h2 id="methods">Methods</h2>
    <ul>
      
        <li>
          <a href="#method-i-active-3F">active?</a>
        </li>
      
        <li>
          <a href="#method-i-add_timestamps">add_timestamps</a>
        </li>
      
        <li>
          <a href="#method-i-connected-3F">connected?</a>
        </li>
      
        <li>
          <a href="#method-i-create_virtual_table">create_virtual_table</a>
        </li>
      
        <li>
          <a href="#method-i-database_exists-3F">database_exists?</a>
        </li>
      
        <li>
          <a href="#method-c-dbconsole">dbconsole</a>
        </li>
      
        <li>
          <a href="#method-i-disconnect-21">disconnect!</a>
        </li>
      
        <li>
          <a href="#method-i-drop_virtual_table">drop_virtual_table</a>
        </li>
      
        <li>
          <a href="#method-i-encoding">encoding</a>
        </li>
      
        <li>
          <a href="#method-i-foreign_keys">foreign_keys</a>
        </li>
      
        <li>
          <a href="#method-c-new">new</a>
        </li>
      
        <li>
          <a href="#method-c-new_client">new_client</a>
        </li>
      
        <li>
          <a href="#method-i-rename_table">rename_table</a>
        </li>
      
        <li>
          <a href="#method-i-requires_reloading-3F">requires_reloading?</a>
        </li>
      
        <li>
          <a href="#method-c-strict_strings_by_default">strict_strings_by_default</a>
        </li>
      
        <li>
          <a href="#method-i-supports_check_constraints-3F">supports_check_constraints?</a>
        </li>
      
        <li>
          <a href="#method-i-supports_common_table_expressions-3F">supports_common_table_expressions?</a>
        </li>
      
        <li>
          <a href="#method-i-supports_concurrent_connections-3F">supports_concurrent_connections?</a>
        </li>
      
        <li>
          <a href="#method-i-supports_datetime_with_precision-3F">supports_datetime_with_precision?</a>
        </li>
      
        <li>
          <a href="#method-i-supports_ddl_transactions-3F">supports_ddl_transactions?</a>
        </li>
      
        <li>
          <a href="#method-i-supports_deferrable_constraints-3F">supports_deferrable_constraints?</a>
        </li>
      
        <li>
          <a href="#method-i-supports_explain-3F">supports_explain?</a>
        </li>
      
        <li>
          <a href="#method-i-supports_expression_index-3F">supports_expression_index?</a>
        </li>
      
        <li>
          <a href="#method-i-supports_foreign_keys-3F">supports_foreign_keys?</a>
        </li>
      
        <li>
          <a href="#method-i-supports_index_sort_order-3F">supports_index_sort_order?</a>
        </li>
      
        <li>
          <a href="#method-i-supports_insert_conflict_target-3F">supports_insert_conflict_target?</a>
        </li>
      
        <li>
          <a href="#method-i-supports_insert_on_conflict-3F">supports_insert_on_conflict?</a>
        </li>
      
        <li>
          <a href="#method-i-supports_insert_on_duplicate_skip-3F">supports_insert_on_duplicate_skip?</a>
        </li>
      
        <li>
          <a href="#method-i-supports_insert_on_duplicate_update-3F">supports_insert_on_duplicate_update?</a>
        </li>
      
        <li>
          <a href="#method-i-supports_insert_returning-3F">supports_insert_returning?</a>
        </li>
      
        <li>
          <a href="#method-i-supports_json-3F">supports_json?</a>
        </li>
      
        <li>
          <a href="#method-i-supports_lazy_transactions-3F">supports_lazy_transactions?</a>
        </li>
      
        <li>
          <a href="#method-i-supports_partial_index-3F">supports_partial_index?</a>
        </li>
      
        <li>
          <a href="#method-i-supports_savepoints-3F">supports_savepoints?</a>
        </li>
      
        <li>
          <a href="#method-i-supports_transaction_isolation-3F">supports_transaction_isolation?</a>
        </li>
      
        <li>
          <a href="#method-i-supports_views-3F">supports_views?</a>
        </li>
      
        <li>
          <a href="#method-i-supports_virtual_columns-3F">supports_virtual_columns?</a>
        </li>
      
        <li>
          <a href="#method-i-virtual_tables">virtual_tables</a>
        </li>
      
    </ul>
  

  
    <!-- Includes -->
    <h2 id="included-modules">Included Modules</h2>
    <ul>
      
        <li>
          
            <a href="SQLite3/DatabaseStatements.html">
              ActiveRecord::ConnectionAdapters::SQLite3::DatabaseStatements
            </a>
          
        </li>
      
    </ul>
  

  
    

    

    
      <!-- Section constants -->
      <h2 id="constants">Constants</h2>
      <table border='0' cellpadding='5'>
        
          <tr valign='top'>
            <td class="attr-name">ADAPTER_NAME</td>
            <td>=</td>
            <td class="attr-value">&quot;SQLite&quot;</td>
          </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">COLLATE_REGEX</td>
            <td>=</td>
            <td class="attr-value">/.*&quot;(\w+)&quot;.*collate\s+&quot;(\w+)&quot;.*/i</td>
          </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">DEFAULT_PRAGMAS</td>
            <td>=</td>
            <td class="attr-value">{
&quot;foreign_keys&quot;        =&gt; true,
&quot;journal_mode&quot;        =&gt; :wal,
&quot;synchronous&quot;         =&gt; :normal,
&quot;mmap_size&quot;           =&gt; 134217728, # 128 megabytes
&quot;journal_size_limit&quot;  =&gt; 67108864, # 64 megabytes
&quot;cache_size&quot;          =&gt; 2000
}</td>
          </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">DEFERRABLE_REGEX</td>
            <td>=</td>
            <td class="attr-value">/DEFERRABLE INITIALLY (\w+)/</td>
          </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">EXTENDED_TYPE_MAPS</td>
            <td>=</td>
            <td class="attr-value">Concurrent::Map.new</td>
          </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">FINAL_CLOSE_PARENS_REGEX</td>
            <td>=</td>
            <td class="attr-value">/\);*\z/</td>
          </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">FK_REGEX</td>
            <td>=</td>
            <td class="attr-value">/.*FOREIGN KEY\s+\(&quot;([^&quot;]+)&quot;\)\s+REFERENCES\s+&quot;(\w+)&quot;\s+\(&quot;(\w+)&quot;\)/</td>
          </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">GENERATED_ALWAYS_AS_REGEX</td>
            <td>=</td>
            <td class="attr-value">/.*&quot;(\w+)&quot;.+GENERATED ALWAYS AS \((.+)\) (?:STORED|VIRTUAL)/i</td>
          </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">NATIVE_DATABASE_TYPES</td>
            <td>=</td>
            <td class="attr-value">{
primary_key:  &quot;integer PRIMARY KEY AUTOINCREMENT NOT NULL&quot;,
string:       { name: &quot;varchar&quot; },
text:         { name: &quot;text&quot; },
integer:      { name: &quot;integer&quot; },
float:        { name: &quot;float&quot; },
decimal:      { name: &quot;decimal&quot; },
datetime:     { name: &quot;datetime&quot; },
time:         { name: &quot;time&quot; },
date:         { name: &quot;date&quot; },
binary:       { name: &quot;blob&quot; },
boolean:      { name: &quot;boolean&quot; },
json:         { name: &quot;json&quot; },
}</td>
          </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">PRIMARY_KEY_AUTOINCREMENT_REGEX</td>
            <td>=</td>
            <td class="attr-value">/.*&quot;(\w+)&quot;.+PRIMARY KEY AUTOINCREMENT/i</td>
          </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">TYPE_MAP</td>
            <td>=</td>
            <td class="attr-value">Type::TypeMap.new.tap { |m| initialize_type_map(m) }</td>
          </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">UNQUOTED_OPEN_PARENS_REGEX</td>
            <td>=</td>
            <td class="attr-value">/\((?![^&#39;&quot;]*[&#39;&quot;][^&#39;&quot;]*$)/</td>
          </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">VIRTUAL_TABLE_REGEX</td>
            <td>=</td>
            <td class="attr-value">/USING\s+(\w+)\s*\((.+)\)/i</td>
          </tr>
          
        
      </table>
    

    

    <!-- Methods -->
    
      <h2 id="class-public-methods">Class Public methods</h2>
      
        <div class="method">
          <h3 id="method-c-dbconsole"><code><b>dbconsole</b>(config, options = {})</code></h3>

          

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">📝 Source code</span>
              </summary>

              <pre><code class="ruby"># File activerecord/lib/active_record/connection_adapters/sqlite3_adapter.rb, line 60
def dbconsole(config, options = {})
  args = []

  args &lt;&lt; &quot;-#{options[:mode]}&quot; if options[:mode]
  args &lt;&lt; &quot;-header&quot; if options[:header]
  args &lt;&lt; File.expand_path(config.database, defined?(Rails.root) ? Rails.root : nil)

  find_cmd_and_exec(ActiveRecord.database_cli[:sqlite], *args)
end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/activerecord/lib/active_record/connection_adapters/sqlite3_adapter.rb#L60" target="_blank" class="github_url">🔎 See on GitHub</a>
              
            </details>
          
        </div>
        
        <div class="method">
          <h3 id="method-c-new"><code><b>new</b>(...)</code></h3>

          

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">📝 Source code</span>
              </summary>

              <pre><code class="ruby"># File activerecord/lib/active_record/connection_adapters/sqlite3_adapter.rb, line 129
def initialize(...)
  super

  @memory_database = false
  case @config[:database].to_s
  when &quot;&quot;
    raise ArgumentError, &quot;No database file specified. Missing argument: database&quot;
  when &quot;:memory:&quot;
    @memory_database = true
  when /\Afile:/
  else
    # Otherwise we have a path relative to Rails.root
    @config[:database] = File.expand_path(@config[:database], Rails.root) if defined?(Rails.root)
    dirname = File.dirname(@config[:database])
    unless File.directory?(dirname)
      begin
        FileUtils.mkdir_p(dirname)
      rescue SystemCallError
        raise ActiveRecord::NoDatabaseError.new(connection_pool: @pool)
      end
    end
  end

  @previous_read_uncommitted = nil
  @config[:strict] = ConnectionAdapters::SQLite3Adapter.strict_strings_by_default unless @config.key?(:strict)

  extensions = @config.fetch(:extensions, []).map do |extension|
    extension.safe_constantize || extension
  end

  @connection_parameters = @config.merge(
    database: @config[:database].to_s,
    results_as_hash: true,
    default_transaction_mode: :immediate,
    extensions: extensions
  )
end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/activerecord/lib/active_record/connection_adapters/sqlite3_adapter.rb#L129" target="_blank" class="github_url">🔎 See on GitHub</a>
              
            </details>
          
        </div>
        
        <div class="method">
          <h3 id="method-c-new_client"><code><b>new_client</b>(config)</code></h3>

          

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">📝 Source code</span>
              </summary>

              <pre><code class="ruby"># File activerecord/lib/active_record/connection_adapters/sqlite3_adapter.rb, line 50
def new_client(config)
  ::SQLite3::Database.new(config[:database].to_s, config)
rescue Errno::ENOENT =&gt; error
  if error.message.include?(&quot;No such file or directory&quot;)
    raise ActiveRecord::NoDatabaseError
  else
    raise
  end
end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/activerecord/lib/active_record/connection_adapters/sqlite3_adapter.rb#L50" target="_blank" class="github_url">🔎 See on GitHub</a>
              
            </details>
          
        </div>
        
        <div class="method">
          <h3 id="method-c-strict_strings_by_default"><code><b>strict_strings_by_default</b></code></h3>

          <div class="description">
<p>Configure the <a href="SQLite3Adapter.html"><code>SQLite3Adapter</code></a> to be used in a “strict strings” mode. When enabled, this will <a href="https://www.sqlite.org/quirks.html#double_quoted_string_literals_are_accepted">disallow double-quoted string literals in SQL statements</a>, which may prevent some typographical errors like creating an index for a non-existent column. The default is <code>false</code>.</p>

<p>If you wish to enable this mode you can add the following line to your application.rb file:</p>

<pre><code>config.active_record.sqlite3_adapter_strict_strings_by_default = true
</code></pre>

<p>This can also be configured on individual databases by setting the <code>strict:</code> option.</p>
</div>

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">📝 Source code</span>
              </summary>

              <pre><code class="ruby"># File activerecord/lib/active_record/connection_adapters/sqlite3_adapter.rb, line 94
class_attribute :strict_strings_by_default, default: false
</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/activerecord/lib/active_record/connection_adapters/sqlite3_adapter.rb#L94" target="_blank" class="github_url">🔎 See on GitHub</a>
              
            </details>
          
        </div>
        
      
    
      <h2 id="instance-public-methods">Instance Public methods</h2>
      
        <div class="method">
          <h3 id="method-i-active-3F"><code><b>active?</b>()</code></h3>

          

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">📝 Source code</span>
              </summary>

              <pre><code class="ruby"># File activerecord/lib/active_record/connection_adapters/sqlite3_adapter.rb, line 242
def active?
  if connected?
    verified!
    true
  end
end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/activerecord/lib/active_record/connection_adapters/sqlite3_adapter.rb#L242" target="_blank" class="github_url">🔎 See on GitHub</a>
              
            </details>
          
        </div>
        
        <div class="method">
          <h3 id="method-i-add_timestamps"><code><b>add_timestamps</b>(table_name, **options)</code></h3>

          

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">📝 Source code</span>
              </summary>

              <pre><code class="ruby"># File activerecord/lib/active_record/connection_adapters/sqlite3_adapter.rb, line 425
def add_timestamps(table_name, **options)
  options[:null] = false if options[:null].nil?

  if !options.key?(:precision)
    options[:precision] = 6
  end

  alter_table(table_name) do |definition|
    definition.column :created_at, :datetime, **options
    definition.column :updated_at, :datetime, **options
  end
end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/activerecord/lib/active_record/connection_adapters/sqlite3_adapter.rb#L425" target="_blank" class="github_url">🔎 See on GitHub</a>
              
            </details>
          
        </div>
        
        <div class="method">
          <h3 id="method-i-connected-3F"><code><b>connected?</b>()</code></h3>

          

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">📝 Source code</span>
              </summary>

              <pre><code class="ruby"># File activerecord/lib/active_record/connection_adapters/sqlite3_adapter.rb, line 238
def connected?
  !(@raw_connection.nil? || @raw_connection.closed?)
end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/activerecord/lib/active_record/connection_adapters/sqlite3_adapter.rb#L238" target="_blank" class="github_url">🔎 See on GitHub</a>
              
            </details>
          
        </div>
        
        <div class="method">
          <h3 id="method-i-create_virtual_table"><code><b>create_virtual_table</b>(table_name, module_name, values)</code></h3>

          <div class="description">
<p>Creates a virtual table</p>

<p>Example:</p>

<pre><code>create_virtual_table :emails, :fts5, [&#39;sender&#39;, &#39;title&#39;, &#39;body&#39;]
</code></pre>
</div>

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">📝 Source code</span>
              </summary>

              <pre><code class="ruby"># File activerecord/lib/active_record/connection_adapters/sqlite3_adapter.rb, line 341
def create_virtual_table(table_name, module_name, values)
  exec_query &quot;CREATE VIRTUAL TABLE IF NOT EXISTS #{table_name} USING #{module_name} (#{values.join(&quot;, &quot;)})&quot;
end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/activerecord/lib/active_record/connection_adapters/sqlite3_adapter.rb#L341" target="_blank" class="github_url">🔎 See on GitHub</a>
              
            </details>
          
        </div>
        
        <div class="method">
          <h3 id="method-i-database_exists-3F"><code><b>database_exists?</b>()</code></h3>

          

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">📝 Source code</span>
              </summary>

              <pre><code class="ruby"># File activerecord/lib/active_record/connection_adapters/sqlite3_adapter.rb, line 167
def database_exists?
  @config[:database] == &quot;:memory:&quot; || File.exist?(@config[:database].to_s)
end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/activerecord/lib/active_record/connection_adapters/sqlite3_adapter.rb#L167" target="_blank" class="github_url">🔎 See on GitHub</a>
              
            </details>
          
        </div>
        
        <div class="method">
          <h3 id="method-i-disconnect-21"><code><b>disconnect!</b>()</code></h3>

          <div class="description">
<p>Disconnects from the database if already connected. Otherwise, this method does nothing.</p>
</div>

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">📝 Source code</span>
              </summary>

              <pre><code class="ruby"># File activerecord/lib/active_record/connection_adapters/sqlite3_adapter.rb, line 253
def disconnect!
  super

  @raw_connection&amp;.close rescue nil
  @raw_connection = nil
end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/activerecord/lib/active_record/connection_adapters/sqlite3_adapter.rb#L253" target="_blank" class="github_url">🔎 See on GitHub</a>
              
            </details>
          
        </div>
        
        <div class="method">
          <h3 id="method-i-drop_virtual_table"><code><b>drop_virtual_table</b>(table_name, module_name, values, **options)</code></h3>

          <div class="description">
<p>Drops a virtual table</p>

<p>Although this command ignores <code>module_name</code> and <code>values</code>, it can be helpful to provide these in a migration’s <code>change</code> method so it can be reverted. In that case, <code>module_name</code>, <code>values</code> and <code>options</code> will be used by <a href="SQLite3Adapter.html#method-i-create_virtual_table"><code>create_virtual_table</code></a>.</p>
</div>

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">📝 Source code</span>
              </summary>

              <pre><code class="ruby"># File activerecord/lib/active_record/connection_adapters/sqlite3_adapter.rb, line 350
def drop_virtual_table(table_name, module_name, values, **options)
  drop_table(table_name)
end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/activerecord/lib/active_record/connection_adapters/sqlite3_adapter.rb#L350" target="_blank" class="github_url">🔎 See on GitHub</a>
              
            </details>
          
        </div>
        
        <div class="method">
          <h3 id="method-i-encoding"><code><b>encoding</b>()</code></h3>

          <div class="description">
<p>Returns the current database encoding format as a string, e.g. ‘UTF-8’</p>
</div>

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">📝 Source code</span>
              </summary>

              <pre><code class="ruby"># File activerecord/lib/active_record/connection_adapters/sqlite3_adapter.rb, line 265
def encoding
  any_raw_connection.encoding.to_s
end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/activerecord/lib/active_record/connection_adapters/sqlite3_adapter.rb#L265" target="_blank" class="github_url">🔎 See on GitHub</a>
              
            </details>
          
        </div>
        
        <div class="method">
          <h3 id="method-i-foreign_keys"><code><b>foreign_keys</b>(table_name)</code></h3>

          

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">📝 Source code</span>
              </summary>

              <pre><code class="ruby"># File activerecord/lib/active_record/connection_adapters/sqlite3_adapter.rb, line 445
def foreign_keys(table_name)
  # SQLite returns 1 row for each column of composite foreign keys.
  fk_info = internal_exec_query(&quot;PRAGMA foreign_key_list(#{quote(table_name)})&quot;, &quot;SCHEMA&quot;)
  # Deferred or immediate foreign keys can only be seen in the CREATE TABLE sql
  fk_defs = table_structure_sql(table_name)
              .select do |column_string|
                column_string.start_with?(&quot;CONSTRAINT&quot;) &amp;&amp;
                column_string.include?(&quot;FOREIGN KEY&quot;)
              end
              .to_h do |fk_string|
                _, from, table, to = fk_string.match(FK_REGEX).to_a
                _, mode = fk_string.match(DEFERRABLE_REGEX).to_a
                deferred = mode&amp;.downcase&amp;.to_sym || false
                [[table, from, to], deferred]
              end

  grouped_fk = fk_info.group_by { |row| row[&quot;id&quot;] }.values.each { |group| group.sort_by! { |row| row[&quot;seq&quot;] } }
  grouped_fk.map do |group|
    row = group.first
    options = {
      on_delete: extract_foreign_key_action(row[&quot;on_delete&quot;]),
      on_update: extract_foreign_key_action(row[&quot;on_update&quot;]),
      deferrable: fk_defs[[row[&quot;table&quot;], row[&quot;from&quot;], row[&quot;to&quot;]]]
    }

    if group.one?
      options[:column] = row[&quot;from&quot;]
      options[:primary_key] = row[&quot;to&quot;]
    else
      options[:column] = group.map { |row| row[&quot;from&quot;] }
      options[:primary_key] = group.map { |row| row[&quot;to&quot;] }
    end
    ForeignKeyDefinition.new(table_name, row[&quot;table&quot;], options)
  end
end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/activerecord/lib/active_record/connection_adapters/sqlite3_adapter.rb#L445" target="_blank" class="github_url">🔎 See on GitHub</a>
              
            </details>
          
        </div>
        
        <div class="method">
          <h3 id="method-i-rename_table"><code><b>rename_table</b>(table_name, new_name, **options)</code></h3>

          <div class="description">
<p>Renames a table.</p>

<p>Example:</p>

<pre><code>rename_table(&#39;octopuses&#39;, &#39;octopi&#39;)
</code></pre>
</div>

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">📝 Source code</span>
              </summary>

              <pre><code class="ruby"># File activerecord/lib/active_record/connection_adapters/sqlite3_adapter.rb, line 358
def rename_table(table_name, new_name, **options)
  validate_table_length!(new_name) unless options[:_uses_legacy_table_name]
  schema_cache.clear_data_source_cache!(table_name.to_s)
  schema_cache.clear_data_source_cache!(new_name.to_s)
  exec_query &quot;ALTER TABLE #{quote_table_name(table_name)} RENAME TO #{quote_table_name(new_name)}&quot;
  rename_table_indexes(table_name, new_name, **options)
end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/activerecord/lib/active_record/connection_adapters/sqlite3_adapter.rb#L358" target="_blank" class="github_url">🔎 See on GitHub</a>
              
            </details>
          
        </div>
        
        <div class="method">
          <h3 id="method-i-requires_reloading-3F"><code><b>requires_reloading?</b>()</code></h3>

          

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">📝 Source code</span>
              </summary>

              <pre><code class="ruby"># File activerecord/lib/active_record/connection_adapters/sqlite3_adapter.rb, line 191
def requires_reloading?
  true
end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/activerecord/lib/active_record/connection_adapters/sqlite3_adapter.rb#L191" target="_blank" class="github_url">🔎 See on GitHub</a>
              
            </details>
          
        </div>
        
        <div class="method">
          <h3 id="method-i-supports_check_constraints-3F"><code><b>supports_check_constraints?</b>()</code></h3>

          

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">📝 Source code</span>
              </summary>

              <pre><code class="ruby"># File activerecord/lib/active_record/connection_adapters/sqlite3_adapter.rb, line 199
def supports_check_constraints?
  true
end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/activerecord/lib/active_record/connection_adapters/sqlite3_adapter.rb#L199" target="_blank" class="github_url">🔎 See on GitHub</a>
              
            </details>
          
        </div>
        
        <div class="method">
          <h3 id="method-i-supports_common_table_expressions-3F"><code><b>supports_common_table_expressions?</b>()</code></h3>

          

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">📝 Source code</span>
              </summary>

              <pre><code class="ruby"># File activerecord/lib/active_record/connection_adapters/sqlite3_adapter.rb, line 215
def supports_common_table_expressions?
  true
end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/activerecord/lib/active_record/connection_adapters/sqlite3_adapter.rb#L215" target="_blank" class="github_url">🔎 See on GitHub</a>
              
            </details>
          
        </div>
        
        <div class="method">
          <h3 id="method-i-supports_concurrent_connections-3F"><code><b>supports_concurrent_connections?</b>()</code></h3>

          

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">📝 Source code</span>
              </summary>

              <pre><code class="ruby"># File activerecord/lib/active_record/connection_adapters/sqlite3_adapter.rb, line 230
def supports_concurrent_connections?
  !@memory_database
end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/activerecord/lib/active_record/connection_adapters/sqlite3_adapter.rb#L230" target="_blank" class="github_url">🔎 See on GitHub</a>
              
            </details>
          
        </div>
        
        <div class="method">
          <h3 id="method-i-supports_datetime_with_precision-3F"><code><b>supports_datetime_with_precision?</b>()</code></h3>

          

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">📝 Source code</span>
              </summary>

              <pre><code class="ruby"># File activerecord/lib/active_record/connection_adapters/sqlite3_adapter.rb, line 207
def supports_datetime_with_precision?
  true
end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/activerecord/lib/active_record/connection_adapters/sqlite3_adapter.rb#L207" target="_blank" class="github_url">🔎 See on GitHub</a>
              
            </details>
          
        </div>
        
        <div class="method">
          <h3 id="method-i-supports_ddl_transactions-3F"><code><b>supports_ddl_transactions?</b>()</code></h3>

          

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">📝 Source code</span>
              </summary>

              <pre><code class="ruby"># File activerecord/lib/active_record/connection_adapters/sqlite3_adapter.rb, line 171
def supports_ddl_transactions?
  true
end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/activerecord/lib/active_record/connection_adapters/sqlite3_adapter.rb#L171" target="_blank" class="github_url">🔎 See on GitHub</a>
              
            </details>
          
        </div>
        
        <div class="method">
          <h3 id="method-i-supports_deferrable_constraints-3F"><code><b>supports_deferrable_constraints?</b>()</code></h3>

          

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">📝 Source code</span>
              </summary>

              <pre><code class="ruby"># File activerecord/lib/active_record/connection_adapters/sqlite3_adapter.rb, line 277
def supports_deferrable_constraints?
  true
end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/activerecord/lib/active_record/connection_adapters/sqlite3_adapter.rb#L277" target="_blank" class="github_url">🔎 See on GitHub</a>
              
            </details>
          
        </div>
        
        <div class="method">
          <h3 id="method-i-supports_explain-3F"><code><b>supports_explain?</b>()</code></h3>

          

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">📝 Source code</span>
              </summary>

              <pre><code class="ruby"># File activerecord/lib/active_record/connection_adapters/sqlite3_adapter.rb, line 269
def supports_explain?
  true
end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/activerecord/lib/active_record/connection_adapters/sqlite3_adapter.rb#L269" target="_blank" class="github_url">🔎 See on GitHub</a>
              
            </details>
          
        </div>
        
        <div class="method">
          <h3 id="method-i-supports_expression_index-3F"><code><b>supports_expression_index?</b>()</code></h3>

          

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">📝 Source code</span>
              </summary>

              <pre><code class="ruby"># File activerecord/lib/active_record/connection_adapters/sqlite3_adapter.rb, line 187
def supports_expression_index?
  true
end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/activerecord/lib/active_record/connection_adapters/sqlite3_adapter.rb#L187" target="_blank" class="github_url">🔎 See on GitHub</a>
              
            </details>
          
        </div>
        
        <div class="method">
          <h3 id="method-i-supports_foreign_keys-3F"><code><b>supports_foreign_keys?</b>()</code></h3>

          

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">📝 Source code</span>
              </summary>

              <pre><code class="ruby"># File activerecord/lib/active_record/connection_adapters/sqlite3_adapter.rb, line 195
def supports_foreign_keys?
  true
end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/activerecord/lib/active_record/connection_adapters/sqlite3_adapter.rb#L195" target="_blank" class="github_url">🔎 See on GitHub</a>
              
            </details>
          
        </div>
        
        <div class="method">
          <h3 id="method-i-supports_index_sort_order-3F"><code><b>supports_index_sort_order?</b>()</code></h3>

          

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">📝 Source code</span>
              </summary>

              <pre><code class="ruby"># File activerecord/lib/active_record/connection_adapters/sqlite3_adapter.rb, line 260
def supports_index_sort_order?
  true
end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/activerecord/lib/active_record/connection_adapters/sqlite3_adapter.rb#L260" target="_blank" class="github_url">🔎 See on GitHub</a>
              
            </details>
          
        </div>
        
        <div class="method">
          <h3 id="method-i-supports_insert_conflict_target-3F"><code><b>supports_insert_conflict_target?</b>()</code></h3>

          

          

          
            <p class="method__aka">
              Alias for:
              <a href="/classes/ActiveRecord/ConnectionAdapters/SQLite3Adapter.html#method-i-supports_insert_on_conflict-3F" class="ref-link"><code>supports_insert_on_conflict?</code></a>.
            </p>
          

          
          
        </div>
        
        <div class="method">
          <h3 id="method-i-supports_insert_on_conflict-3F"><code><b>supports_insert_on_conflict?</b>()</code></h3>

          

          
            <p class="method__aka">
              Also aliased as:
              
              <a href="/classes/ActiveRecord/ConnectionAdapters/SQLite3Adapter.html#method-i-supports_insert_on_duplicate_skip-3F" class="ref-link"><code>supports_insert_on_duplicate_skip?</code></a>, <a href="/classes/ActiveRecord/ConnectionAdapters/SQLite3Adapter.html#method-i-supports_insert_on_duplicate_update-3F" class="ref-link"><code>supports_insert_on_duplicate_update?</code></a>, <a href="/classes/ActiveRecord/ConnectionAdapters/SQLite3Adapter.html#method-i-supports_insert_conflict_target-3F" class="ref-link"><code>supports_insert_conflict_target?</code></a>.
            </p>
          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">📝 Source code</span>
              </summary>

              <pre><code class="ruby"># File activerecord/lib/active_record/connection_adapters/sqlite3_adapter.rb, line 223
def supports_insert_on_conflict?
  database_version &gt;= &quot;3.24.0&quot;
end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/activerecord/lib/active_record/connection_adapters/sqlite3_adapter.rb#L223" target="_blank" class="github_url">🔎 See on GitHub</a>
              
            </details>
          
        </div>
        
        <div class="method">
          <h3 id="method-i-supports_insert_on_duplicate_skip-3F"><code><b>supports_insert_on_duplicate_skip?</b>()</code></h3>

          

          

          
            <p class="method__aka">
              Alias for:
              <a href="/classes/ActiveRecord/ConnectionAdapters/SQLite3Adapter.html#method-i-supports_insert_on_conflict-3F" class="ref-link"><code>supports_insert_on_conflict?</code></a>.
            </p>
          

          
          
        </div>
        
        <div class="method">
          <h3 id="method-i-supports_insert_on_duplicate_update-3F"><code><b>supports_insert_on_duplicate_update?</b>()</code></h3>

          

          

          
            <p class="method__aka">
              Alias for:
              <a href="/classes/ActiveRecord/ConnectionAdapters/SQLite3Adapter.html#method-i-supports_insert_on_conflict-3F" class="ref-link"><code>supports_insert_on_conflict?</code></a>.
            </p>
          

          
          
        </div>
        
        <div class="method">
          <h3 id="method-i-supports_insert_returning-3F"><code><b>supports_insert_returning?</b>()</code></h3>

          

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">📝 Source code</span>
              </summary>

              <pre><code class="ruby"># File activerecord/lib/active_record/connection_adapters/sqlite3_adapter.rb, line 219
def supports_insert_returning?
  database_version &gt;= &quot;3.35.0&quot;
end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/activerecord/lib/active_record/connection_adapters/sqlite3_adapter.rb#L219" target="_blank" class="github_url">🔎 See on GitHub</a>
              
            </details>
          
        </div>
        
        <div class="method">
          <h3 id="method-i-supports_json-3F"><code><b>supports_json?</b>()</code></h3>

          

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">📝 Source code</span>
              </summary>

              <pre><code class="ruby"># File activerecord/lib/active_record/connection_adapters/sqlite3_adapter.rb, line 211
def supports_json?
  true
end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/activerecord/lib/active_record/connection_adapters/sqlite3_adapter.rb#L211" target="_blank" class="github_url">🔎 See on GitHub</a>
              
            </details>
          
        </div>
        
        <div class="method">
          <h3 id="method-i-supports_lazy_transactions-3F"><code><b>supports_lazy_transactions?</b>()</code></h3>

          

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">📝 Source code</span>
              </summary>

              <pre><code class="ruby"># File activerecord/lib/active_record/connection_adapters/sqlite3_adapter.rb, line 273
def supports_lazy_transactions?
  true
end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/activerecord/lib/active_record/connection_adapters/sqlite3_adapter.rb#L273" target="_blank" class="github_url">🔎 See on GitHub</a>
              
            </details>
          
        </div>
        
        <div class="method">
          <h3 id="method-i-supports_partial_index-3F"><code><b>supports_partial_index?</b>()</code></h3>

          

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">📝 Source code</span>
              </summary>

              <pre><code class="ruby"># File activerecord/lib/active_record/connection_adapters/sqlite3_adapter.rb, line 183
def supports_partial_index?
  true
end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/activerecord/lib/active_record/connection_adapters/sqlite3_adapter.rb#L183" target="_blank" class="github_url">🔎 See on GitHub</a>
              
            </details>
          
        </div>
        
        <div class="method">
          <h3 id="method-i-supports_savepoints-3F"><code><b>supports_savepoints?</b>()</code></h3>

          

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">📝 Source code</span>
              </summary>

              <pre><code class="ruby"># File activerecord/lib/active_record/connection_adapters/sqlite3_adapter.rb, line 175
def supports_savepoints?
  true
end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/activerecord/lib/active_record/connection_adapters/sqlite3_adapter.rb#L175" target="_blank" class="github_url">🔎 See on GitHub</a>
              
            </details>
          
        </div>
        
        <div class="method">
          <h3 id="method-i-supports_transaction_isolation-3F"><code><b>supports_transaction_isolation?</b>()</code></h3>

          

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">📝 Source code</span>
              </summary>

              <pre><code class="ruby"># File activerecord/lib/active_record/connection_adapters/sqlite3_adapter.rb, line 179
def supports_transaction_isolation?
  true
end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/activerecord/lib/active_record/connection_adapters/sqlite3_adapter.rb#L179" target="_blank" class="github_url">🔎 See on GitHub</a>
              
            </details>
          
        </div>
        
        <div class="method">
          <h3 id="method-i-supports_views-3F"><code><b>supports_views?</b>()</code></h3>

          

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">📝 Source code</span>
              </summary>

              <pre><code class="ruby"># File activerecord/lib/active_record/connection_adapters/sqlite3_adapter.rb, line 203
def supports_views?
  true
end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/activerecord/lib/active_record/connection_adapters/sqlite3_adapter.rb#L203" target="_blank" class="github_url">🔎 See on GitHub</a>
              
            </details>
          
        </div>
        
        <div class="method">
          <h3 id="method-i-supports_virtual_columns-3F"><code><b>supports_virtual_columns?</b>()</code></h3>

          

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">📝 Source code</span>
              </summary>

              <pre><code class="ruby"># File activerecord/lib/active_record/connection_adapters/sqlite3_adapter.rb, line 234
def supports_virtual_columns?
  database_version &gt;= &quot;3.31.0&quot;
end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/activerecord/lib/active_record/connection_adapters/sqlite3_adapter.rb#L234" target="_blank" class="github_url">🔎 See on GitHub</a>
              
            </details>
          
        </div>
        
        <div class="method">
          <h3 id="method-i-virtual_tables"><code><b>virtual_tables</b>()</code></h3>

          <div class="description">
<p>Returns a list of defined virtual tables</p>
</div>

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">📝 Source code</span>
              </summary>

              <pre><code class="ruby"># File activerecord/lib/active_record/connection_adapters/sqlite3_adapter.rb, line 325
def virtual_tables
  query = &lt;&lt;~SQL
    SELECT name, sql FROM sqlite_master WHERE sql LIKE &#39;CREATE VIRTUAL %&#39;;
  SQL

  exec_query(query, &quot;SCHEMA&quot;).cast_values.each_with_object({}) do |row, memo|
    table_name, sql = row[0], row[1]
    _, module_name, arguments = sql.match(VIRTUAL_TABLE_REGEX).to_a
    memo[table_name] = [module_name, arguments]
  end.to_a
end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/activerecord/lib/active_record/connection_adapters/sqlite3_adapter.rb#L325" target="_blank" class="github_url">🔎 See on GitHub</a>
              
            </details>
          
        </div>
        
      
    
  
</div>

    </div>
</div>
