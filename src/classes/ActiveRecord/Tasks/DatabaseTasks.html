---
title: ActiveRecord::Tasks::DatabaseTasks
layout: default
---
<div class="main">
    <div class="banner">
        
            <span>Ruby on Rails 8.1.0</span><br />
        
        <div class="type">Module</div>
        <h1>
            ActiveRecord::Tasks::DatabaseTasks
            
        </h1>
        <ul class="files">
            
            <li><a href="../../../files/activerecord/lib/active_record/tasks/database_tasks_rb.html">activerecord/lib/active_record/tasks/database_tasks.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
  
    <div class="description">
      
<h1 id="module-ActiveRecord::Tasks::DatabaseTasks-label-Active+Record+DatabaseTasks">Active Record DatabaseTasks</h1>

<p><a href="DatabaseTasks.html"><code>ActiveRecord::Tasks::DatabaseTasks</code></a> is a utility class, which encapsulates logic behind common tasks used to manage database and migrations.</p>

<p>The tasks defined here are used with Rails commands provided by Active Record.</p>

<p>In order to use <a href="DatabaseTasks.html"><code>DatabaseTasks</code></a>, a few config values need to be set. All the needed config values are set by Rails already, so itâ€™s necessary to do it only if you want to change the defaults or when you want to use Active Record outside of Rails (in such case after configuring the database tasks, you can also use the rake tasks defined in Active Record).</p>

<p>The possible config values are:</p>
<ul><li>
<p><code>env</code>: current environment (like <a href="../../Rails.html#method-c-env"><code>Rails.env</code></a>).</p>
</li><li>
<p><a href="DatabaseTasks.html#attribute-i-database_configuration"><code>database_configuration</code></a>: configuration of your databases (as in <code>config/database.yml</code>).</p>
</li><li>
<p><a href="DatabaseTasks.html#method-i-db_dir"><code>db_dir</code></a>: your <code>db</code> directory.</p>
</li><li>
<p><a href="DatabaseTasks.html#method-i-fixtures_path"><code>fixtures_path</code></a>: a path to fixtures directory.</p>
</li><li>
<p><a href="DatabaseTasks.html#method-i-migrations_paths"><code>migrations_paths</code></a>: a list of paths to directories with migrations.</p>
</li><li>
<p><a href="DatabaseTasks.html#method-i-seed_loader"><code>seed_loader</code></a>: an object which will load seeds, it needs to respond to the <a href="DatabaseTasks.html#method-i-load_seed"><code>load_seed</code></a> method.</p>
</li><li>
<p><code>root</code>: a path to the root of the application.</p>
</li></ul>

<p>Example usage of <a href="DatabaseTasks.html"><code>DatabaseTasks</code></a> outside Rails could look as such:</p>

<pre><code>include ActiveRecord::Tasks
DatabaseTasks.database_configuration = YAML.load_file(&#39;my_database_config.yml&#39;)
DatabaseTasks.db_dir = &#39;db&#39;
# other settings...

DatabaseTasks.create_current(&#39;production&#39;)
</code></pre>

    </div>
  

  

  
  


  

  
    <h2 id="methods">Methods</h2>
    <ul>
      
        <li>
          <a href="#method-i-cache_dump_filename">cache_dump_filename</a>
        </li>
      
        <li>
          <a href="#method-i-charset">charset</a>
        </li>
      
        <li>
          <a href="#method-i-charset_current">charset_current</a>
        </li>
      
        <li>
          <a href="#method-i-check_protected_environments-21">check_protected_environments!</a>
        </li>
      
        <li>
          <a href="#method-i-check_schema_file">check_schema_file</a>
        </li>
      
        <li>
          <a href="#method-i-check_target_version">check_target_version</a>
        </li>
      
        <li>
          <a href="#method-i-clear_schema_cache">clear_schema_cache</a>
        </li>
      
        <li>
          <a href="#method-i-collation">collation</a>
        </li>
      
        <li>
          <a href="#method-i-collation_current">collation_current</a>
        </li>
      
        <li>
          <a href="#method-i-create">create</a>
        </li>
      
        <li>
          <a href="#method-i-create_all">create_all</a>
        </li>
      
        <li>
          <a href="#method-i-create_current">create_current</a>
        </li>
      
        <li>
          <a href="#method-i-db_dir">db_dir</a>
        </li>
      
        <li>
          <a href="#method-i-drop">drop</a>
        </li>
      
        <li>
          <a href="#method-i-drop_all">drop_all</a>
        </li>
      
        <li>
          <a href="#method-i-drop_current">drop_current</a>
        </li>
      
        <li>
          <a href="#method-i-dump_all">dump_all</a>
        </li>
      
        <li>
          <a href="#method-i-dump_schema_cache">dump_schema_cache</a>
        </li>
      
        <li>
          <a href="#method-i-env">env</a>
        </li>
      
        <li>
          <a href="#method-i-fixtures_path">fixtures_path</a>
        </li>
      
        <li>
          <a href="#method-i-load_schema_current">load_schema_current</a>
        </li>
      
        <li>
          <a href="#method-i-load_seed">load_seed</a>
        </li>
      
        <li>
          <a href="#method-i-migrate">migrate</a>
        </li>
      
        <li>
          <a href="#method-i-migrate_all">migrate_all</a>
        </li>
      
        <li>
          <a href="#method-i-migrate_status">migrate_status</a>
        </li>
      
        <li>
          <a href="#method-i-migrations_paths">migrations_paths</a>
        </li>
      
        <li>
          <a href="#method-i-name">name</a>
        </li>
      
        <li>
          <a href="#method-i-prepare_all">prepare_all</a>
        </li>
      
        <li>
          <a href="#method-i-purge">purge</a>
        </li>
      
        <li>
          <a href="#method-i-purge_all">purge_all</a>
        </li>
      
        <li>
          <a href="#method-i-purge_current">purge_current</a>
        </li>
      
        <li>
          <a href="#method-i-register_task">register_task</a>
        </li>
      
        <li>
          <a href="#method-i-root">root</a>
        </li>
      
        <li>
          <a href="#method-i-schema_dump_path">schema_dump_path</a>
        </li>
      
        <li>
          <a href="#method-i-schema_up_to_date-3F">schema_up_to_date?</a>
        </li>
      
        <li>
          <a href="#method-i-seed_loader">seed_loader</a>
        </li>
      
        <li>
          <a href="#method-i-structure_dump">structure_dump</a>
        </li>
      
        <li>
          <a href="#method-c-structure_dump_flags">structure_dump_flags</a>
        </li>
      
        <li>
          <a href="#method-i-structure_load">structure_load</a>
        </li>
      
        <li>
          <a href="#method-c-structure_load_flags">structure_load_flags</a>
        </li>
      
        <li>
          <a href="#method-i-target_version">target_version</a>
        </li>
      
        <li>
          <a href="#method-i-truncate_all">truncate_all</a>
        </li>
      
    </ul>
  

  

  
    

    

    
      <!-- Section constants -->
      <h2 id="constants">Constants</h2>
      <table border='0' cellpadding='5'>
        
          <tr valign='top'>
            <td class="attr-name">LOCAL_HOSTS</td>
            <td>=</td>
            <td class="attr-value">[&quot;127.0.0.1&quot;, &quot;localhost&quot;]</td>
          </tr>
          
        
      </table>
    

    
      <!-- Section attributes -->
      <h2 id="attributes">Attributes</h2>
      <table border='0' cellpadding='5'>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [RW]
            </td>
            <td class='attr-name'>database_configuration</td>
            <td class='attr-desc'></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [W]
            </td>
            <td class='attr-name'>db_dir</td>
            <td class='attr-desc'></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [W]
            </td>
            <td class='attr-name'>env</td>
            <td class='attr-desc'></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [W]
            </td>
            <td class='attr-name'>fixtures_path</td>
            <td class='attr-desc'></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [W]
            </td>
            <td class='attr-name'>migrations_paths</td>
            <td class='attr-desc'></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [W]
            </td>
            <td class='attr-name'>root</td>
            <td class='attr-desc'></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [W]
            </td>
            <td class='attr-name'>seed_loader</td>
            <td class='attr-desc'></td>
          </tr>
        
      </table>
    

    <!-- Methods -->
    
      <h2 id="class-public-methods">Class Public methods</h2>
      
        <div class="method">
          <h3 id="method-c-structure_dump_flags"><code><b>structure_dump_flags</b></code></h3>

          <div class="description">
<p>Extra flags passed to database CLI tool (mysqldump/pg_dump) when calling db:schema:dump It can be used as a string/array (the typical case) or a hash (when you use multiple adapters) Example:</p>

<pre><code>ActiveRecord::Tasks::DatabaseTasks.structure_dump_flags = {
  mysql2: [&#39;--no-defaults&#39;, &#39;--skip-add-drop-table&#39;],
  postgresql: &#39;--no-tablespaces&#39;
}
</code></pre>
</div>

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">ğŸ“ Source code</span>
              </summary>

              <pre><code class="ruby"># File activerecord/lib/active_record/tasks/database_tasks.rb, line 50
mattr_accessor :structure_dump_flags, instance_accessor: false
</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/activerecord/lib/active_record/tasks/database_tasks.rb#L50" target="_blank" class="github_url">ğŸ” See on GitHub</a>
              
            </details>
          
        </div>
        
        <div class="method">
          <h3 id="method-c-structure_load_flags"><code><b>structure_load_flags</b></code></h3>

          <div class="description">
<p>Extra flags passed to database CLI tool when calling db:schema:load It can be used as a string/array (the typical case) or a hash (when you use multiple adapters)</p>
</div>

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">ğŸ“ Source code</span>
              </summary>

              <pre><code class="ruby"># File activerecord/lib/active_record/tasks/database_tasks.rb, line 56
mattr_accessor :structure_load_flags, instance_accessor: false
</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/activerecord/lib/active_record/tasks/database_tasks.rb#L56" target="_blank" class="github_url">ğŸ” See on GitHub</a>
              
            </details>
          
        </div>
        
      
    
      <h2 id="instance-public-methods">Instance Public methods</h2>
      
        <div class="method">
          <h3 id="method-i-cache_dump_filename"><code><b>cache_dump_filename</b>(db_config, schema_cache_path: nil)</code></h3>

          

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">ğŸ“ Source code</span>
              </summary>

              <pre><code class="ruby"># File activerecord/lib/active_record/tasks/database_tasks.rb, line 484
def cache_dump_filename(db_config, schema_cache_path: nil)
  schema_cache_path ||
    db_config.schema_cache_path ||
    db_config.default_schema_cache_path(ActiveRecord::Tasks::DatabaseTasks.db_dir)
end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/activerecord/lib/active_record/tasks/database_tasks.rb#L484" target="_blank" class="github_url">ğŸ” See on GitHub</a>
              
            </details>
          
        </div>
        
        <div class="method">
          <h3 id="method-i-charset"><code><b>charset</b>(configuration, *arguments)</code></h3>

          

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">ğŸ“ Source code</span>
              </summary>

              <pre><code class="ruby"># File activerecord/lib/active_record/tasks/database_tasks.rb, line 330
def charset(configuration, *arguments)
  db_config = resolve_configuration(configuration)
  database_adapter_for(db_config, *arguments).charset
end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/activerecord/lib/active_record/tasks/database_tasks.rb#L330" target="_blank" class="github_url">ğŸ” See on GitHub</a>
              
            </details>
          
        </div>
        
        <div class="method">
          <h3 id="method-i-charset_current"><code><b>charset_current</b>(env_name = env, db_name = name)</code></h3>

          

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">ğŸ“ Source code</span>
              </summary>

              <pre><code class="ruby"># File activerecord/lib/active_record/tasks/database_tasks.rb, line 325
def charset_current(env_name = env, db_name = name)
  db_config = configs_for(env_name: env_name, name: db_name)
  charset(db_config)
end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/activerecord/lib/active_record/tasks/database_tasks.rb#L325" target="_blank" class="github_url">ğŸ” See on GitHub</a>
              
            </details>
          
        </div>
        
        <div class="method">
          <h3 id="method-i-check_protected_environments-21"><code><b>check_protected_environments!</b>(environment = env)</code></h3>

          

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">ğŸ“ Source code</span>
              </summary>

              <pre><code class="ruby"># File activerecord/lib/active_record/tasks/database_tasks.rb, line 65
def check_protected_environments!(environment = env)
  return if ENV[&quot;DISABLE_DATABASE_ENVIRONMENT_CHECK&quot;]

  configs_for(env_name: environment).each do |db_config|
    database_adapter_for(db_config).check_current_protected_environment!(db_config, migration_class)
  end
end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/activerecord/lib/active_record/tasks/database_tasks.rb#L65" target="_blank" class="github_url">ğŸ” See on GitHub</a>
              
            </details>
          
        </div>
        
        <div class="method">
          <h3 id="method-i-check_schema_file"><code><b>check_schema_file</b>(filename)</code></h3>

          

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">ğŸ“ Source code</span>
              </summary>

              <pre><code class="ruby"># File activerecord/lib/active_record/tasks/database_tasks.rb, line 498
def check_schema_file(filename)
  unless File.exist?(filename)
    message = +%{#{filename} doesn&#39;t exist yet. Run `bin/rails db:migrate` to create it, then try again.}
    message &lt;&lt; %{ If you do not intend to use a database, you should instead alter #{Rails.root}/config/application.rb to limit the frameworks that will be loaded.} if defined?(::Rails.root)
    Kernel.abort message
  end
end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/activerecord/lib/active_record/tasks/database_tasks.rb#L498" target="_blank" class="github_url">ğŸ” See on GitHub</a>
              
            </details>
          
        </div>
        
        <div class="method">
          <h3 id="method-i-check_target_version"><code><b>check_target_version</b>()</code></h3>

          

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">ğŸ“ Source code</span>
              </summary>

              <pre><code class="ruby"># File activerecord/lib/active_record/tasks/database_tasks.rb, line 315
def check_target_version
  if target_version &amp;&amp; !Migration.valid_version_format?(ENV[&quot;VERSION&quot;])
    raise &quot;Invalid format of target version: `VERSION=#{ENV[&#39;VERSION&#39;]}`&quot;
  end
end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/activerecord/lib/active_record/tasks/database_tasks.rb#L315" target="_blank" class="github_url">ğŸ” See on GitHub</a>
              
            </details>
          
        </div>
        
        <div class="method">
          <h3 id="method-i-clear_schema_cache"><code><b>clear_schema_cache</b>(filename)</code></h3>

          

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">ğŸ“ Source code</span>
              </summary>

              <pre><code class="ruby"># File activerecord/lib/active_record/tasks/database_tasks.rb, line 524
def clear_schema_cache(filename)
  FileUtils.rm_f filename, verbose: false
end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/activerecord/lib/active_record/tasks/database_tasks.rb#L524" target="_blank" class="github_url">ğŸ” See on GitHub</a>
              
            </details>
          
        </div>
        
        <div class="method">
          <h3 id="method-i-collation"><code><b>collation</b>(configuration, *arguments)</code></h3>

          

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">ğŸ“ Source code</span>
              </summary>

              <pre><code class="ruby"># File activerecord/lib/active_record/tasks/database_tasks.rb, line 340
def collation(configuration, *arguments)
  db_config = resolve_configuration(configuration)
  database_adapter_for(db_config, *arguments).collation
end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/activerecord/lib/active_record/tasks/database_tasks.rb#L340" target="_blank" class="github_url">ğŸ” See on GitHub</a>
              
            </details>
          
        </div>
        
        <div class="method">
          <h3 id="method-i-collation_current"><code><b>collation_current</b>(env_name = env, db_name = name)</code></h3>

          

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">ğŸ“ Source code</span>
              </summary>

              <pre><code class="ruby"># File activerecord/lib/active_record/tasks/database_tasks.rb, line 335
def collation_current(env_name = env, db_name = name)
  db_config = configs_for(env_name: env_name, name: db_name)
  collation(db_config)
end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/activerecord/lib/active_record/tasks/database_tasks.rb#L335" target="_blank" class="github_url">ğŸ” See on GitHub</a>
              
            </details>
          
        </div>
        
        <div class="method">
          <h3 id="method-i-create"><code><b>create</b>(configuration, *arguments)</code></h3>

          

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">ğŸ“ Source code</span>
              </summary>

              <pre><code class="ruby"># File activerecord/lib/active_record/tasks/database_tasks.rb, line 115
def create(configuration, *arguments)
  db_config = resolve_configuration(configuration)
  database_adapter_for(db_config, *arguments).create
  $stdout.puts &quot;Created database &#39;#{db_config.database}&#39;&quot; if verbose?
rescue DatabaseAlreadyExists
  $stderr.puts &quot;Database &#39;#{db_config.database}&#39; already exists&quot; if verbose?
rescue Exception =&gt; error
  $stderr.puts error
  $stderr.puts &quot;Couldn&#39;t create &#39;#{db_config.database}&#39; database. Please check your configuration.&quot;
  raise
end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/activerecord/lib/active_record/tasks/database_tasks.rb#L115" target="_blank" class="github_url">ğŸ” See on GitHub</a>
              
            </details>
          
        </div>
        
        <div class="method">
          <h3 id="method-i-create_all"><code><b>create_all</b>()</code></h3>

          

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">ğŸ“ Source code</span>
              </summary>

              <pre><code class="ruby"># File activerecord/lib/active_record/tasks/database_tasks.rb, line 127
def create_all
  db_config = migration_connection.pool.db_config

  each_local_configuration { |db_config| create(db_config) }

  migration_class.establish_connection(db_config)
end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/activerecord/lib/active_record/tasks/database_tasks.rb#L127" target="_blank" class="github_url">ğŸ” See on GitHub</a>
              
            </details>
          
        </div>
        
        <div class="method">
          <h3 id="method-i-create_current"><code><b>create_current</b>(environment = env, name = nil)</code></h3>

          

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">ğŸ“ Source code</span>
              </summary>

              <pre><code class="ruby"># File activerecord/lib/active_record/tasks/database_tasks.rb, line 168
def create_current(environment = env, name = nil)
  each_current_configuration(environment, name) { |db_config| create(db_config) }

  migration_class.establish_connection(environment.to_sym)
end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/activerecord/lib/active_record/tasks/database_tasks.rb#L168" target="_blank" class="github_url">ğŸ” See on GitHub</a>
              
            </details>
          
        </div>
        
        <div class="method">
          <h3 id="method-i-db_dir"><code><b>db_dir</b>()</code></h3>

          

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">ğŸ“ Source code</span>
              </summary>

              <pre><code class="ruby"># File activerecord/lib/active_record/tasks/database_tasks.rb, line 83
def db_dir
  @db_dir ||= Rails.application.config.paths[&quot;db&quot;].first
end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/activerecord/lib/active_record/tasks/database_tasks.rb#L83" target="_blank" class="github_url">ğŸ” See on GitHub</a>
              
            </details>
          
        </div>
        
        <div class="method">
          <h3 id="method-i-drop"><code><b>drop</b>(configuration, *arguments)</code></h3>

          

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">ğŸ“ Source code</span>
              </summary>

              <pre><code class="ruby"># File activerecord/lib/active_record/tasks/database_tasks.rb, line 208
def drop(configuration, *arguments)
  db_config = resolve_configuration(configuration)
  database_adapter_for(db_config, *arguments).drop
  $stdout.puts &quot;Dropped database &#39;#{db_config.database}&#39;&quot; if verbose?
rescue ActiveRecord::NoDatabaseError
  $stderr.puts &quot;Database &#39;#{db_config.database}&#39; does not exist&quot;
rescue Exception =&gt; error
  $stderr.puts error
  $stderr.puts &quot;Couldn&#39;t drop database &#39;#{db_config.database}&#39;&quot;
  raise
end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/activerecord/lib/active_record/tasks/database_tasks.rb#L208" target="_blank" class="github_url">ğŸ” See on GitHub</a>
              
            </details>
          
        </div>
        
        <div class="method">
          <h3 id="method-i-drop_all"><code><b>drop_all</b>()</code></h3>

          

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">ğŸ“ Source code</span>
              </summary>

              <pre><code class="ruby"># File activerecord/lib/active_record/tasks/database_tasks.rb, line 220
def drop_all
  each_local_configuration { |db_config| drop(db_config) }
end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/activerecord/lib/active_record/tasks/database_tasks.rb#L220" target="_blank" class="github_url">ğŸ” See on GitHub</a>
              
            </details>
          
        </div>
        
        <div class="method">
          <h3 id="method-i-drop_current"><code><b>drop_current</b>(environment = env)</code></h3>

          

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">ğŸ“ Source code</span>
              </summary>

              <pre><code class="ruby"># File activerecord/lib/active_record/tasks/database_tasks.rb, line 224
def drop_current(environment = env)
  each_current_configuration(environment) { |db_config| drop(db_config) }
end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/activerecord/lib/active_record/tasks/database_tasks.rb#L224" target="_blank" class="github_url">ğŸ” See on GitHub</a>
              
            </details>
          
        </div>
        
        <div class="method">
          <h3 id="method-i-dump_all"><code><b>dump_all</b>()</code></h3>

          

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">ğŸ“ Source code</span>
              </summary>

              <pre><code class="ruby"># File activerecord/lib/active_record/tasks/database_tasks.rb, line 430
def dump_all
  seen_schemas = []

  ActiveRecord::Base.configurations.configs_for(env_name: ActiveRecord::Tasks::DatabaseTasks.env).each do |db_config|
    schema_path = schema_dump_path(db_config, ENV[&quot;SCHEMA_FORMAT&quot;] || db_config.schema_format)

    next if seen_schemas.include?(schema_path)

    ActiveRecord::Tasks::DatabaseTasks.dump_schema(db_config, ENV[&quot;SCHEMA_FORMAT&quot;] || db_config.schema_format)
    seen_schemas &lt;&lt; schema_path
  end
end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/activerecord/lib/active_record/tasks/database_tasks.rb#L430" target="_blank" class="github_url">ğŸ” See on GitHub</a>
              
            </details>
          
        </div>
        
        <div class="method">
          <h3 id="method-i-dump_schema_cache"><code><b>dump_schema_cache</b>(conn_or_pool, filename)</code></h3>

          <div class="description">
<p>Dumps the schema cache in YAML format for the connection into the file</p>

<h4 id="method-i-dump_schema_cache-label-Examples">Examples</h4>

<pre><code>ActiveRecord::Tasks::DatabaseTasks.dump_schema_cache(ActiveRecord::Base.lease_connection, &quot;tmp/schema_dump.yaml&quot;)
</code></pre>
</div>

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">ğŸ“ Source code</span>
              </summary>

              <pre><code class="ruby"># File activerecord/lib/active_record/tasks/database_tasks.rb, line 520
def dump_schema_cache(conn_or_pool, filename)
  conn_or_pool.schema_cache.dump_to(filename)
end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/activerecord/lib/active_record/tasks/database_tasks.rb#L520" target="_blank" class="github_url">ğŸ” See on GitHub</a>
              
            </details>
          
        </div>
        
        <div class="method">
          <h3 id="method-i-env"><code><b>env</b>()</code></h3>

          

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">ğŸ“ Source code</span>
              </summary>

              <pre><code class="ruby"># File activerecord/lib/active_record/tasks/database_tasks.rb, line 103
def env
  @env ||= Rails.env
end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/activerecord/lib/active_record/tasks/database_tasks.rb#L103" target="_blank" class="github_url">ğŸ” See on GitHub</a>
              
            </details>
          
        </div>
        
        <div class="method">
          <h3 id="method-i-fixtures_path"><code><b>fixtures_path</b>()</code></h3>

          

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">ğŸ“ Source code</span>
              </summary>

              <pre><code class="ruby"># File activerecord/lib/active_record/tasks/database_tasks.rb, line 91
def fixtures_path
  @fixtures_path ||= if ENV[&quot;FIXTURES_PATH&quot;]
    File.join(root, ENV[&quot;FIXTURES_PATH&quot;])
  else
    File.join(root, &quot;test&quot;, &quot;fixtures&quot;)
  end
end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/activerecord/lib/active_record/tasks/database_tasks.rb#L91" target="_blank" class="github_url">ğŸ” See on GitHub</a>
              
            </details>
          
        </div>
        
        <div class="method">
          <h3 id="method-i-load_schema_current"><code><b>load_schema_current</b>(format = nil, file = nil, environment = env)</code></h3>

          

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">ğŸ“ Source code</span>
              </summary>

              <pre><code class="ruby"># File activerecord/lib/active_record/tasks/database_tasks.rb, line 490
def load_schema_current(format = nil, file = nil, environment = env)
  each_current_configuration(environment) do |db_config|
    with_temporary_connection(db_config) do
      load_schema(db_config, format || db_config.schema_format, file)
    end
  end
end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/activerecord/lib/active_record/tasks/database_tasks.rb#L490" target="_blank" class="github_url">ğŸ” See on GitHub</a>
              
            </details>
          
        </div>
        
        <div class="method">
          <h3 id="method-i-load_seed"><code><b>load_seed</b>()</code></h3>

          

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">ğŸ“ Source code</span>
              </summary>

              <pre><code class="ruby"># File activerecord/lib/active_record/tasks/database_tasks.rb, line 506
def load_seed
  if seed_loader
    seed_loader.load_seed
  else
    raise &quot;You tried to load seed data, but no seed loader is specified. Please specify seed &quot; \
          &quot;loader with ActiveRecord::Tasks::DatabaseTasks.seed_loader = your_seed_loader\n&quot; \
          &quot;Seed loader should respond to load_seed method&quot;
  end
end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/activerecord/lib/active_record/tasks/database_tasks.rb#L506" target="_blank" class="github_url">ğŸ” See on GitHub</a>
              
            </details>
          
        </div>
        
        <div class="method">
          <h3 id="method-i-migrate"><code><b>migrate</b>(version = nil, skip_initialize: false)</code></h3>

          

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">ğŸ“ Source code</span>
              </summary>

              <pre><code class="ruby"># File activerecord/lib/active_record/tasks/database_tasks.rb, line 260
def migrate(version = nil, skip_initialize: false)
  scope = ENV[&quot;SCOPE&quot;]
  verbose_was, Migration.verbose = Migration.verbose, verbose?

  check_target_version

  initialize_database(migration_connection_pool.db_config) unless skip_initialize

  migration_connection_pool.migration_context.migrate(target_version) do |migration|
    if version.blank?
      scope.blank? || scope == migration.scope
    else
      migration.version == version
    end
  end.tap do |migrations_ran|
    Migration.write(&quot;No migrations ran. (using #{scope} scope)&quot;) if scope.present? &amp;&amp; migrations_ran.empty?
  end

  migration_connection_pool.schema_cache.clear!
ensure
  Migration.verbose = verbose_was
end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/activerecord/lib/active_record/tasks/database_tasks.rb#L260" target="_blank" class="github_url">ğŸ” See on GitHub</a>
              
            </details>
          
        </div>
        
        <div class="method">
          <h3 id="method-i-migrate_all"><code><b>migrate_all</b>()</code></h3>

          

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">ğŸ“ Source code</span>
              </summary>

              <pre><code class="ruby"># File activerecord/lib/active_record/tasks/database_tasks.rb, line 241
def migrate_all
  db_configs = ActiveRecord::Base.configurations.configs_for(env_name: ActiveRecord::Tasks::DatabaseTasks.env)
  db_configs.each { |db_config| initialize_database(db_config) }

  if db_configs.size == 1 &amp;&amp; db_configs.first.primary?
    ActiveRecord::Tasks::DatabaseTasks.migrate(skip_initialize: true)
  else
    mapped_versions = ActiveRecord::Tasks::DatabaseTasks.db_configs_with_versions

    mapped_versions.sort.each do |version, db_configs|
      db_configs.each do |db_config|
        ActiveRecord::Tasks::DatabaseTasks.with_temporary_connection(db_config) do
          ActiveRecord::Tasks::DatabaseTasks.migrate(version, skip_initialize: true)
        end
      end
    end
  end
end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/activerecord/lib/active_record/tasks/database_tasks.rb#L241" target="_blank" class="github_url">ğŸ” See on GitHub</a>
              
            </details>
          
        </div>
        
        <div class="method">
          <h3 id="method-i-migrate_status"><code><b>migrate_status</b>()</code></h3>

          

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">ğŸ“ Source code</span>
              </summary>

              <pre><code class="ruby"># File activerecord/lib/active_record/tasks/database_tasks.rb, line 300
def migrate_status
  unless migration_connection_pool.schema_migration.table_exists?
    Kernel.abort &quot;Schema migrations table does not exist yet.&quot;
  end

  # output
  puts &quot;\ndatabase: #{migration_connection_pool.db_config.database}\n\n&quot;
  puts &quot;#{&#39;Status&#39;.center(8)}  #{&#39;Migration ID&#39;.ljust(14)}  Migration Name&quot;
  puts &quot;-&quot; * 50
  migration_connection_pool.migration_context.migrations_status.each do |status, version, name|
    puts &quot;#{status.center(8)}  #{version.ljust(14)}  #{name}&quot;
  end
  puts
end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/activerecord/lib/active_record/tasks/database_tasks.rb#L300" target="_blank" class="github_url">ğŸ” See on GitHub</a>
              
            </details>
          
        </div>
        
        <div class="method">
          <h3 id="method-i-migrations_paths"><code><b>migrations_paths</b>()</code></h3>

          

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">ğŸ“ Source code</span>
              </summary>

              <pre><code class="ruby"># File activerecord/lib/active_record/tasks/database_tasks.rb, line 87
def migrations_paths
  @migrations_paths ||= Rails.application.paths[&quot;db/migrate&quot;].to_a
end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/activerecord/lib/active_record/tasks/database_tasks.rb#L87" target="_blank" class="github_url">ğŸ” See on GitHub</a>
              
            </details>
          
        </div>
        
        <div class="method">
          <h3 id="method-i-name"><code><b>name</b>()</code></h3>

          

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">ğŸ“ Source code</span>
              </summary>

              <pre><code class="ruby"># File activerecord/lib/active_record/tasks/database_tasks.rb, line 107
def name
  @name ||= &quot;primary&quot;
end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/activerecord/lib/active_record/tasks/database_tasks.rb#L107" target="_blank" class="github_url">ğŸ” See on GitHub</a>
              
            </details>
          
        </div>
        
        <div class="method">
          <h3 id="method-i-prepare_all"><code><b>prepare_all</b>()</code></h3>

          

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">ğŸ“ Source code</span>
              </summary>

              <pre><code class="ruby"># File activerecord/lib/active_record/tasks/database_tasks.rb, line 174
def prepare_all
  seed = false
  dump_db_configs = []

  each_current_configuration(env) do |db_config|
    database_initialized = initialize_database(db_config)

    seed = true if database_initialized &amp;&amp; db_config.seeds?
  end

  each_current_environment(env) do |environment|
    db_configs_with_versions(environment).sort.each do |version, db_configs|
      dump_db_configs |= db_configs

      db_configs.each do |db_config|
        with_temporary_pool(db_config) do
          migrate(version)
        end
      end
    end
  end

  # Dump schema for databases that were migrated.
  if ActiveRecord.dump_schema_after_migration
    dump_db_configs.each do |db_config|
      with_temporary_pool(db_config) do
        dump_schema(db_config)
      end
    end
  end

  load_seed if seed
end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/activerecord/lib/active_record/tasks/database_tasks.rb#L174" target="_blank" class="github_url">ğŸ” See on GitHub</a>
              
            </details>
          
        </div>
        
        <div class="method">
          <h3 id="method-i-purge"><code><b>purge</b>(configuration)</code></h3>

          

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">ğŸ“ Source code</span>
              </summary>

              <pre><code class="ruby"># File activerecord/lib/active_record/tasks/database_tasks.rb, line 345
def purge(configuration)
  db_config = resolve_configuration(configuration)
  database_adapter_for(db_config).purge
end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/activerecord/lib/active_record/tasks/database_tasks.rb#L345" target="_blank" class="github_url">ğŸ” See on GitHub</a>
              
            </details>
          
        </div>
        
        <div class="method">
          <h3 id="method-i-purge_all"><code><b>purge_all</b>()</code></h3>

          

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">ğŸ“ Source code</span>
              </summary>

              <pre><code class="ruby"># File activerecord/lib/active_record/tasks/database_tasks.rb, line 350
def purge_all
  each_local_configuration { |db_config| purge(db_config) }
end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/activerecord/lib/active_record/tasks/database_tasks.rb#L350" target="_blank" class="github_url">ğŸ” See on GitHub</a>
              
            </details>
          
        </div>
        
        <div class="method">
          <h3 id="method-i-purge_current"><code><b>purge_current</b>(environment = env)</code></h3>

          

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">ğŸ“ Source code</span>
              </summary>

              <pre><code class="ruby"># File activerecord/lib/active_record/tasks/database_tasks.rb, line 354
def purge_current(environment = env)
  each_current_configuration(environment) { |db_config| purge(db_config) }

  migration_class.establish_connection(environment.to_sym)
end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/activerecord/lib/active_record/tasks/database_tasks.rb#L354" target="_blank" class="github_url">ğŸ” See on GitHub</a>
              
            </details>
          
        </div>
        
        <div class="method">
          <h3 id="method-i-register_task"><code><b>register_task</b>(pattern, task)</code></h3>

          

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">ğŸ“ Source code</span>
              </summary>

              <pre><code class="ruby"># File activerecord/lib/active_record/tasks/database_tasks.rb, line 73
def register_task(pattern, task)
  @tasks ||= {}
  @tasks[pattern] = task
end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/activerecord/lib/active_record/tasks/database_tasks.rb#L73" target="_blank" class="github_url">ğŸ” See on GitHub</a>
              
            </details>
          
        </div>
        
        <div class="method">
          <h3 id="method-i-root"><code><b>root</b>()</code></h3>

          

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">ğŸ“ Source code</span>
              </summary>

              <pre><code class="ruby"># File activerecord/lib/active_record/tasks/database_tasks.rb, line 99
def root
  @root ||= Rails.root
end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/activerecord/lib/active_record/tasks/database_tasks.rb#L99" target="_blank" class="github_url">ğŸ” See on GitHub</a>
              
            </details>
          
        </div>
        
        <div class="method">
          <h3 id="method-i-schema_dump_path"><code><b>schema_dump_path</b>(db_config, format = db_config.schema_format)</code></h3>

          

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">ğŸ“ Source code</span>
              </summary>

              <pre><code class="ruby"># File activerecord/lib/active_record/tasks/database_tasks.rb, line 471
def schema_dump_path(db_config, format = db_config.schema_format)
  return ENV[&quot;SCHEMA&quot;] if ENV[&quot;SCHEMA&quot;]

  filename = db_config.schema_dump(format)
  return unless filename

  if File.dirname(filename) == ActiveRecord::Tasks::DatabaseTasks.db_dir
    filename
  else
    File.join(ActiveRecord::Tasks::DatabaseTasks.db_dir, filename)
  end
end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/activerecord/lib/active_record/tasks/database_tasks.rb#L471" target="_blank" class="github_url">ğŸ” See on GitHub</a>
              
            </details>
          
        </div>
        
        <div class="method">
          <h3 id="method-i-schema_up_to_date-3F"><code><b>schema_up_to_date?</b>(configuration, _ = nil, file = nil)</code></h3>

          

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">ğŸ“ Source code</span>
              </summary>

              <pre><code class="ruby"># File activerecord/lib/active_record/tasks/database_tasks.rb, line 396
def schema_up_to_date?(configuration, _ = nil, file = nil)
  db_config = resolve_configuration(configuration)

  file ||= schema_dump_path(db_config)

  return true unless file &amp;&amp; File.exist?(file)

  with_temporary_pool(db_config) do |pool|
    internal_metadata = pool.internal_metadata
    return false unless internal_metadata.enabled?
    return false unless internal_metadata.table_exists?

    internal_metadata[:schema_sha1] == schema_sha1(file)
  end
end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/activerecord/lib/active_record/tasks/database_tasks.rb#L396" target="_blank" class="github_url">ğŸ” See on GitHub</a>
              
            </details>
          
        </div>
        
        <div class="method">
          <h3 id="method-i-seed_loader"><code><b>seed_loader</b>()</code></h3>

          

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">ğŸ“ Source code</span>
              </summary>

              <pre><code class="ruby"># File activerecord/lib/active_record/tasks/database_tasks.rb, line 111
def seed_loader
  @seed_loader ||= Rails.application
end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/activerecord/lib/active_record/tasks/database_tasks.rb#L111" target="_blank" class="github_url">ğŸ” See on GitHub</a>
              
            </details>
          
        </div>
        
        <div class="method">
          <h3 id="method-i-structure_dump"><code><b>structure_dump</b>(configuration, *arguments)</code></h3>

          

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">ğŸ“ Source code</span>
              </summary>

              <pre><code class="ruby"># File activerecord/lib/active_record/tasks/database_tasks.rb, line 360
def structure_dump(configuration, *arguments)
  db_config = resolve_configuration(configuration)
  filename = arguments.delete_at(0)
  flags = structure_dump_flags_for(db_config.adapter)
  database_adapter_for(db_config, *arguments).structure_dump(filename, flags)
end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/activerecord/lib/active_record/tasks/database_tasks.rb#L360" target="_blank" class="github_url">ğŸ” See on GitHub</a>
              
            </details>
          
        </div>
        
        <div class="method">
          <h3 id="method-i-structure_load"><code><b>structure_load</b>(configuration, *arguments)</code></h3>

          

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">ğŸ“ Source code</span>
              </summary>

              <pre><code class="ruby"># File activerecord/lib/active_record/tasks/database_tasks.rb, line 367
def structure_load(configuration, *arguments)
  db_config = resolve_configuration(configuration)
  filename = arguments.delete_at(0)
  flags = structure_load_flags_for(db_config.adapter)
  database_adapter_for(db_config, *arguments).structure_load(filename, flags)
end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/activerecord/lib/active_record/tasks/database_tasks.rb#L367" target="_blank" class="github_url">ğŸ” See on GitHub</a>
              
            </details>
          
        </div>
        
        <div class="method">
          <h3 id="method-i-target_version"><code><b>target_version</b>()</code></h3>

          

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">ğŸ“ Source code</span>
              </summary>

              <pre><code class="ruby"># File activerecord/lib/active_record/tasks/database_tasks.rb, line 321
def target_version
  ENV[&quot;VERSION&quot;].to_i if ENV[&quot;VERSION&quot;] &amp;&amp; !ENV[&quot;VERSION&quot;].empty?
end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/activerecord/lib/active_record/tasks/database_tasks.rb#L321" target="_blank" class="github_url">ğŸ” See on GitHub</a>
              
            </details>
          
        </div>
        
        <div class="method">
          <h3 id="method-i-truncate_all"><code><b>truncate_all</b>(environment = env)</code></h3>

          

          

          

          
          
            <details class="method__source">
              <summary>
                <span class="label">ğŸ“ Source code</span>
              </summary>

              <pre><code class="ruby"># File activerecord/lib/active_record/tasks/database_tasks.rb, line 235
def truncate_all(environment = env)
  configs_for(env_name: environment).each do |db_config|
    truncate_tables(db_config)
  end
end</code></pre>
              
                <a href="https://github.com/rails/rails/blob/1cdd190a25e483b65f1f25bbd0f13a25d696b461/activerecord/lib/active_record/tasks/database_tasks.rb#L235" target="_blank" class="github_url">ğŸ” See on GitHub</a>
              
            </details>
          
        </div>
        
      
    
  
</div>

    </div>
</div>
